{"version":3,"sources":["../../src/server/appBuilderWorker.ts","../../src/server/toolpadAppBuilder.ts","../../src/constants.ts","../../src/server/viteVirtualPlugin.ts","../../src/runtime/constants.ts","../../src/server/localMode.ts","../../src/utils/insecureHash.ts","../../src/server/schema.ts","../../src/utils/prettier.ts","../../src/server/EnvManager.ts","../../src/server/FunctionsManager.ts","../../src/server/functionsRuntime.ts","../../src/server/functionsShared.ts","../../src/server/versionInfo.ts","../../package.json","../../src/server/DataManager.ts","../../src/toolpadDataSources/postgres/server.ts","../../src/toolpadDataSources/sql/server.ts","../../src/toolpadDataSources/mysql/server.ts","../../src/toolpadDataSources/rest/server.ts","../../src/server/har.ts","../../src/utils/har.ts","../../src/toolpadDataSources/applyTransform.ts","../../src/toolpadDataSources/rest/shared.ts","../../src/toolpadDataSources/googleSheets/server.ts","../../src/server/config.ts","../../src/toolpadDataSources/local/shared.tsx","../../src/toolpadDataSources/local/server.ts","../../src/toolpadDataSources/server.ts","../../src/utils/express.ts","../../src/runtime/toolpadComponents/index.tsx","../../src/packageInfo.ts"],"sourcesContent":["import invariant from 'invariant';\nimport { buildApp } from './toolpadAppBuilder';\nimport { initProject } from './localMode';\n\nasync function main() {\n  invariant(\n    process.env.NODE_ENV === 'production',\n    'The app builder must be run with NODE_ENV=production',\n  );\n  invariant(!!process.env.TOOLPAD_PROJECT_DIR, 'A project root must be defined');\n  invariant(!!process.env.TOOLPAD_BASE, 'A base path must be defined');\n\n  const base = process.env.TOOLPAD_BASE;\n\n  const project = await initProject({\n    dev: false,\n    dir: process.env.TOOLPAD_PROJECT_DIR,\n    base,\n  });\n\n  await project.build();\n\n  await buildApp({\n    root: project.getRoot(),\n    base,\n    getComponents: () => project.getComponentsManifest(),\n    getPagesManifest: () => project.getPagesManifest(),\n    outDir: project.getAppOutputFolder(),\n    loadDom: () => project.loadDom(),\n  });\n\n  await project.writeBuildInfo();\n\n  await project.dispose();\n}\n\nmain().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","import * as path from 'path';\nimport * as url from 'node:url';\nimport * as fs from 'fs';\nimport type { InlineConfig, Plugin } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport { indent } from '@toolpad/utils/strings';\nimport * as appDom from '@toolpad/studio-runtime/appDom';\nimport type { ComponentEntry, PagesManifest } from './localMode';\nimport { INITIAL_STATE_WINDOW_PROPERTY } from '../constants';\nimport viteVirtualPlugin, { VirtualFileContent, replaceFiles } from './viteVirtualPlugin';\nimport { FONTS_URL } from '../runtime/constants';\n\nconst currentDirectory = url.fileURLToPath(new URL('.', import.meta.url));\n\nconst pkgJsonContent = fs.readFileSync(path.resolve(currentDirectory, '../../package.json'), {\n  encoding: 'utf-8',\n});\nconst pkgJson = JSON.parse(pkgJsonContent);\nconst TOOLPAD_BUILD = process.env.GIT_SHA1?.slice(0, 7) || 'dev';\n\nconst MAIN_ENTRY = '/main.tsx';\nconst EDITOR_ENTRY = '/editor.tsx';\n\nfunction getHtmlContent(entry: string) {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"en\">\n      <head>\n        <meta charset=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <title>Toolpad</title>\n        <link rel=\"preload\" href=\"${FONTS_URL}\" as=\"style\" onload=\"this.onload=null;this.rel='stylesheet'\">\n        <noscript><link rel=\"stylesheet\" href=\"${FONTS_URL}\"></noscript>\n      </head>\n      <body>\n        <div id=\"root\"></div>\n    \n        <!-- __TOOLPAD_SCRIPTS__ -->\n\n        <script type=\"module\" src=${JSON.stringify(entry)}></script>\n      </body>\n    </html>\n  `;\n}\n\nfunction getAppHtmlContent() {\n  return getHtmlContent(MAIN_ENTRY);\n}\n\nexport function getEditorHtmlContent() {\n  return getHtmlContent(EDITOR_ENTRY);\n}\n\nfunction toolpadStudioVitePlugin(): Plugin {\n  return {\n    name: 'toolpad-studio',\n\n    async resolveId(id) {\n      if (id.endsWith('.html')) {\n        return id;\n      }\n      return null;\n    },\n\n    async load(id) {\n      if (id.endsWith('index.html')) {\n        // production build only\n        return getAppHtmlContent();\n      }\n\n      if (id.endsWith('editor.html')) {\n        // production build only\n        return getEditorHtmlContent();\n      }\n      return null;\n    },\n  };\n}\n\nexport interface CreateViteConfigParams {\n  toolpadDevMode: boolean;\n  outDir: string;\n  root: string;\n  dev: boolean;\n  base: string;\n  customServer?: boolean;\n  plugins?: Plugin[];\n  getComponents: () => Promise<ComponentEntry[]>;\n  loadDom: () => Promise<appDom.AppDom>;\n  getPagesManifest: () => Promise<PagesManifest>;\n}\n\nexport interface CreateViteConfigResult {\n  reloadComponents: () => Promise<void>;\n  viteConfig: InlineConfig;\n}\n\nexport async function createViteConfig({\n  toolpadDevMode,\n  outDir,\n  root,\n  dev,\n  base,\n  customServer,\n  plugins = [],\n  getComponents,\n  loadDom,\n  getPagesManifest,\n}: CreateViteConfigParams): Promise<CreateViteConfigResult> {\n  const mode = dev ? 'development' : 'production';\n\n  const initialDom = await loadDom();\n  const plan = appDom.getPlan(initialDom);\n\n  const getEntryPoint = (target: 'prod' | 'editor') => {\n    const isEditor = target === 'editor';\n\n    const componentsId = 'virtual:toolpad-files:components.tsx';\n\n    return `\nimport { init, setComponents } from '@toolpad/studio/entrypoint';\nimport components from ${JSON.stringify(componentsId)};\n${isEditor ? `import ToolpadEditor from '@toolpad/studio/editor'` : ''}\n\n${\n  isEditor\n    ? `\n      // importing monaco to get around module ordering issues in esbuild\n      import 'monaco-editor';\n\n      window.MonacoEnvironment = {\n        getWorker: async (_, label) => {\n          // { type: 'module' } is supported in firefox but behind feature flag:\n          // you have to enable it manually via about:config and set dom.workers.modules.enabled to true.\n          if (label === 'typescript') {\n            const { default: TsWorker } = await import('monaco-editor/esm/vs/language/typescript/ts.worker?worker');\n            return new TsWorker();\n          }\n          if (label === 'json') {\n            const { default: JsonWorker } = await import('monaco-editor/esm/vs/language/json/json.worker?worker');\n            return new JsonWorker();\n          }\n          if (label === 'html') {\n            const { default: HtmlWorker } = await import('monaco-editor/esm/vs/language/html/html.worker?worker');\n            return new HtmlWorker();\n          }\n          if (label === 'css') {\n            const { default: CssWorker } = await import('monaco-editor/esm/vs/language/css/css.worker?worker');\n            return new CssWorker();\n          }\n          if (label === 'editorWorkerService') {\n            const { default: EditorWorker } = await import('monaco-editor/esm/vs/editor/editor.worker?worker');\n            return new EditorWorker();\n          }\n          throw new Error(\\`Failed to resolve worker with label \"\\${label}\"\\`);\n        },\n      } as monaco.Environment;\n      `\n    : ''\n}\n\nconst initialState = window[${JSON.stringify(INITIAL_STATE_WINDOW_PROPERTY)}];\n\nsetComponents(components);\n\ninit({\n  ${isEditor ? `ToolpadApp: ToolpadEditor,` : ''}\n  base: ${JSON.stringify(base)},\n  initialState,\n})\n\nif (import.meta.hot) {\n  // TODO: investigate why this doesn't work, see https://github.com/vitejs/vite/issues/12912\n  import.meta.hot.accept(\n    [${JSON.stringify(componentsId)}],\n    (newComponents) => {\n    if (newComponents) {\n      console.log('hot updating Toolpad Studio components')\n      setComponents(\n        newComponents ?? components,\n      );\n    }\n  });\n}\n`;\n  };\n\n  const createComponentsFile = async () => {\n    const components = await getComponents();\n\n    const imports = components.map(\n      ({ name }) => `import ${name} from 'toolpad-user-project:./components/${name}';`,\n    );\n\n    const defaultExportProperties = components.map(\n      ({ name }) => `${JSON.stringify(`codeComponent.${name}`)}: ${name}`,\n    );\n\n    const code = `\n      ${imports.join('\\n')}\n\n      export default {\n        ${indent(defaultExportProperties.join(',\\n'), 2)}\n      };\n    `;\n\n    return {\n      code,\n      map: null,\n    };\n  };\n\n  const virtualFiles = new Map<string, VirtualFileContent>([\n    ['main.tsx', getEntryPoint('prod')],\n    ['editor.tsx', getEntryPoint('editor')],\n    ['components.tsx', await createComponentsFile()],\n    ['pages-manifest.json', JSON.stringify(await getPagesManifest(), null, 2)],\n  ]);\n\n  const virtualToolpadFiles = viteVirtualPlugin(virtualFiles, 'toolpad-files');\n\n  return {\n    reloadComponents: async () => {\n      const newFiles = new Map(virtualFiles);\n      newFiles.set('components.tsx', await createComponentsFile());\n      replaceFiles(virtualToolpadFiles, newFiles);\n    },\n    viteConfig: {\n      configFile: false,\n      mode,\n      build: {\n        outDir,\n        emptyOutDir: true,\n        chunkSizeWarningLimit: Infinity,\n        rollupOptions: {\n          input: {\n            index: path.resolve(currentDirectory, './index.html'),\n            ...(dev ? { editor: path.resolve(currentDirectory, './editor.html') } : {}),\n          },\n          onwarn(warning, warn) {\n            if (warning.code === 'MODULE_LEVEL_DIRECTIVE') {\n              return;\n            }\n            warn(warning);\n          },\n        },\n      },\n      envFile: false,\n      resolve: {\n        dedupe: ['@mui/material', '@emotion/react', '@emotion/styled', '@tanstack/react-query'],\n        alias: [\n          {\n            // FIXME(https://github.com/mui/material-ui/issues/35233)\n            find: /^@mui\\/icons-material\\/(?!esm\\/)([^/]*)/,\n            replacement: '@mui/icons-material/esm/$1',\n          },\n          {\n            find: /^toolpad-user-project:(.*)$/,\n            replacement: `${root}/$1`,\n          },\n          {\n            find: MAIN_ENTRY,\n            replacement: 'virtual:toolpad-files:main.tsx',\n          },\n          {\n            find: '@toolpad/studio',\n            replacement: toolpadDevMode\n              ? // load source\n                path.resolve(currentDirectory, '../../src/exports')\n              : // load compiled\n                path.resolve(currentDirectory, '../exports'),\n          },\n          ...(dev\n            ? [\n                {\n                  find: EDITOR_ENTRY,\n                  replacement: 'virtual:toolpad-files:editor.tsx',\n                },\n                {\n                  find: 'vm',\n                  replacement: 'vm-browserify',\n                },\n              ]\n            : []),\n        ],\n      },\n      optimizeDeps: {\n        include: [\n          ...(dev\n            ? [\n                'perf-cascade',\n                'monaco-editor',\n                'monaco-editor/esm/vs/basic-languages/javascript/javascript',\n                'monaco-editor/esm/vs/basic-languages/typescript/typescript',\n                'monaco-editor/esm/vs/basic-languages/markdown/markdown',\n              ]\n            : ['@toolpad/studio/entrypoint', '@toolpad/studio/editor']),\n        ],\n      },\n      appType: 'custom',\n      logLevel: 'info',\n      root: currentDirectory,\n      plugins: [toolpadStudioVitePlugin(), virtualToolpadFiles, react(), ...plugins],\n      base,\n      define: {\n        'process.env.NODE_ENV': `'${mode}'`,\n        'process.env.BASE_URL': `'${base}'`,\n        'process.env.TOOLPAD_CUSTOM_SERVER': `'${JSON.stringify(customServer)}'`,\n        'process.env.TOOLPAD_VERSION': JSON.stringify(pkgJson.version),\n        'process.env.TOOLPAD_BUILD': JSON.stringify(TOOLPAD_BUILD),\n        'process.env.TOOLPAD_PLAN': JSON.stringify(plan),\n      },\n    },\n  };\n}\n\nexport interface ToolpadBuilderParams {\n  outDir: string;\n  getComponents: () => Promise<ComponentEntry[]>;\n  loadDom: () => Promise<appDom.AppDom>;\n  getPagesManifest: () => Promise<PagesManifest>;\n  root: string;\n  base: string;\n}\n\nexport async function buildApp({\n  root,\n  base,\n  getComponents,\n  getPagesManifest,\n  loadDom,\n  outDir,\n}: ToolpadBuilderParams) {\n  const { viteConfig } = await createViteConfig({\n    toolpadDevMode: false,\n    dev: false,\n    root,\n    base,\n    outDir,\n    getComponents,\n    getPagesManifest,\n    loadDom,\n  });\n  const vite = await import('vite');\n  await vite.build(viteConfig);\n}\n","export const WINDOW_PROP_TOOLPAD_APP_RENDER_PARAMS = '__TOOLPAD_APP_RENDER_PARAMS__';\nexport const INITIAL_STATE_WINDOW_PROPERTY = '__initialToolpadState__';\n\nexport const TOOLPAD_TARGET_CE = 'CE';\nexport const TOOLPAD_TARGET_CLOUD = 'CLOUD';\nexport const TOOLPAD_TARGET_PRO = 'PRO';\nexport const REPOSITORY_URL = 'https://github.com/mui/toolpad';\nexport const LANDING_PAGE_URL = 'https://mui.com/toolpad/';\nexport const DOCUMENTATION_URL = 'https://mui.com/toolpad/studio/getting-started/';\nexport const DOCUMENTATION_INSTALLATION_URL =\n  'https://mui.com/toolpad/studio/getting-started/installation/';\nexport const ROADMAP_URL = 'https://github.com/orgs/mui/projects/9';\nexport const SCHEDULE_DEMO_URL = 'https://calendly.com/prakhar-mui/';\nexport const UPGRADE_URL = 'https://mui.com/toolpad/studio/getting-started/roadmap/#paid-plan';\n\nexport const VERSION_CHECK_INTERVAL = 1000 * 60 * 10;\n\n// TODO: Remove once global functions UI is ready\nexport const FEATURE_FLAG_GLOBAL_FUNCTIONS = false;\n","import { posix as path } from 'path';\nimport { Plugin, ViteDevServer, transformWithEsbuild } from 'vite';\n\nconst API_PROPERTY = Symbol('virtual-fs-api');\n\ninterface VirtualFsPluginApi {\n  replaceFiles: (newFiles: Map<string, LoadResult>) => void;\n}\n\nexport type VirtualFsPlugin = Plugin & { [API_PROPERTY]: VirtualFsPluginApi };\n\nexport type LoadResult = Awaited<ReturnType<Extract<NonNullable<Plugin['load']>, Function>>>;\n\nexport type VirtualFileContent = LoadResult;\n\nexport default function virtualFsPlugin(\n  initialFiles: Map<string, VirtualFileContent>,\n  userIdentifier: string,\n): VirtualFsPlugin {\n  const prefix = `virtual:${userIdentifier}:`;\n  const resolvedPrefix = `\\0${prefix}`;\n  const transformExtensions = new Set(['.js', '.jsx', '.ts', '.tsx']);\n  const resolveExtensions = new Set(['.js', '.jsx', '.ts', '.tsx', '.json']);\n  let serverInstance: ViteDevServer | undefined;\n  let files = initialFiles;\n  return {\n    name: 'virtual-fs',\n\n    enforce: 'pre',\n\n    configureServer(server: ViteDevServer) {\n      serverInstance = server;\n    },\n\n    resolveId(id: string, importer: string | undefined) {\n      if (id.startsWith(prefix)) {\n        const entryPath = id.slice(prefix.length);\n\n        if (files.has(entryPath)) {\n          return `${resolvedPrefix}${entryPath}`;\n        }\n\n        for (const extension of resolveExtensions) {\n          const entryPathWithExtension = `${entryPath}${extension}`;\n          if (files.has(entryPathWithExtension)) {\n            return `${resolvedPrefix}${entryPathWithExtension}`;\n          }\n        }\n      } else if (importer?.startsWith(resolvedPrefix)) {\n        const importerPath = importer.slice(resolvedPrefix.length);\n        const fullPath = path.resolve(path.dirname(importerPath), id);\n        return this.resolve(`${prefix}${fullPath}`, importer);\n      }\n      return null;\n    },\n\n    async load(id) {\n      if (id.startsWith(resolvedPrefix)) {\n        const virtualPath = id.slice(resolvedPrefix.length);\n        const content = files.get(virtualPath);\n        return content;\n      }\n      return null;\n    },\n\n    async transform(code, id) {\n      if (id.startsWith(resolvedPrefix)) {\n        const virtualPath = id.slice(resolvedPrefix.length);\n        if (transformExtensions.has(path.extname(virtualPath))) {\n          return transformWithEsbuild(code, virtualPath);\n        }\n      }\n      return null;\n    },\n\n    [API_PROPERTY]: {\n      async replaceFiles(newFiles: Map<string, LoadResult>) {\n        const filesToInvalidate = [];\n        for (const [virtualPath, content] of files) {\n          if (!newFiles.has(virtualPath) || newFiles.get(virtualPath) !== content) {\n            filesToInvalidate.push(virtualPath);\n          }\n        }\n\n        files = newFiles;\n\n        if (serverInstance) {\n          for (const virtualPath of filesToInvalidate) {\n            const resolvedId = `${resolvedPrefix}${virtualPath}`;\n            const mod = serverInstance.moduleGraph.getModuleById(resolvedId);\n            if (mod) {\n              serverInstance.reloadModule(mod);\n            }\n          }\n        } else {\n          console.warn('Server instance not found, cannot invalidate files');\n        }\n      },\n    },\n  };\n}\n\nexport function replaceFiles(plugin: VirtualFsPlugin, newFiles: Map<string, LoadResult>) {\n  return plugin[API_PROPERTY].replaceFiles(newFiles);\n}\n","export const FONTS_URL =\n  'https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap';\n","import * as path from 'path';\nimport * as fs from 'fs/promises';\nimport { isMainThread } from 'worker_threads';\nimport * as yaml from 'yaml';\nimport invariant from 'invariant';\nimport openEditor from 'open-editor';\nimport chalk from 'chalk';\nimport { BindableAttrValue, EnvAttrValue, PropBindableAttrValue } from '@toolpad/studio-runtime';\nimport { fromZodError } from 'zod-validation-error';\nimport { glob } from 'glob';\nimport * as chokidar from 'chokidar';\nimport { debounce, throttle } from 'lodash-es';\nimport { Emitter } from '@toolpad/utils/events';\nimport { guessTitle, isValidJsIdentifier } from '@toolpad/utils/strings';\nimport { errorFrom } from '@toolpad/utils/errors';\nimport { filterValues, hasOwnProperty, mapValues } from '@toolpad/utils/collections';\nimport { execa } from 'execa';\nimport {\n  writeFileRecursive,\n  readMaybeFile,\n  readMaybeDir,\n  updateYamlFile,\n  fileExists,\n  readJsonFile,\n} from '@toolpad/utils/fs';\nimport { z } from 'zod';\nimport { Awaitable } from '@toolpad/utils/types';\nimport * as appDom from '@toolpad/studio-runtime/appDom';\nimport insecureHash from '../utils/insecureHash';\nimport {\n  Page,\n  Query,\n  ElementType,\n  pageSchema,\n  Template,\n  BindableProp,\n  LocalQueryConfig,\n  FetchQueryConfig,\n  QueryConfig,\n  FetchBody,\n  ResponseType,\n  Theme,\n  themeSchema,\n  API_VERSION,\n  applicationSchema,\n  Application,\n  envBindingSchema,\n} from './schema';\nimport { format, resolvePrettierConfig } from '../utils/prettier';\nimport {\n  Body as AppDomFetchBody,\n  FetchQuery,\n  ResponseType as AppDomRestResponseType,\n} from '../toolpadDataSources/rest/types';\nimport { LocalQuery } from '../toolpadDataSources/local/types';\nimport type { ProjectEvents, ToolpadProjectOptions, CodeEditorFileType } from '../types';\nimport EnvManager from './EnvManager';\nimport FunctionsManager, { CreateDataProviderOptions } from './FunctionsManager';\nimport { VersionInfo, checkVersion } from './versionInfo';\nimport { UPGRADE_URL, VERSION_CHECK_INTERVAL } from '../constants';\nimport DataManager from './DataManager';\nimport { PAGE_COLUMN_COMPONENT_ID, PAGE_ROW_COMPONENT_ID } from '../runtime/toolpadComponents';\nimport packageInfo from '../packageInfo';\n\ndeclare global {\n  // eslint-disable-next-line\n  var __toolpadProjects: Set<string> | undefined;\n}\n\ninvariant(\n  isMainThread,\n  'localMode should be used only in the main thread. Use message passing to get data from the main thread.',\n);\n\nfunction getThemeFile(root: string): string {\n  return path.join(root, './theme.yml');\n}\n\nfunction getApplicationFile(root: string): string {\n  return path.join(root, './application.yml');\n}\n\nfunction getComponentsFolder(root: string): string {\n  return path.join(root, './components');\n}\n\nfunction getPagesFolder(root: string): string {\n  return path.join(root, './pages');\n}\n\nfunction getPageFolder(root: string, name: string): string {\n  const pagesFolder = getPagesFolder(root);\n  const pageFolder = path.resolve(pagesFolder, name);\n  return pageFolder;\n}\n\nfunction getPageFile(root: string, name: string): string {\n  const pageFolder = getPageFolder(root, name);\n  const pageFileName = path.resolve(pageFolder, 'page.yml');\n  return pageFileName;\n}\n\nfunction getComponentFilePath(componentsFolder: string, componentName: string): string {\n  return path.join(componentsFolder, `${componentName}.tsx`);\n}\n\nexport function getOutputFolder(root: string) {\n  return path.join(root, '.generated');\n}\n\nfunction getAppOutputFolder(root: string) {\n  return path.join(getOutputFolder(root), 'app');\n}\n\nexport interface ComponentEntry {\n  name: string;\n  path: string;\n}\n\nexport type ComponentsManifest = ComponentEntry[];\n\nasync function loadPagesFromFiles(root: string): Promise<PagesContent> {\n  const pagesFolder = getPagesFolder(root);\n  const entries = await readMaybeDir(pagesFolder);\n  const resultEntries = await Promise.all(\n    entries.map(async (entry): Promise<[string, Page] | null> => {\n      if (entry.isDirectory()) {\n        const pageName = entry.name;\n\n        const pageDirEntries = new Set(await fs.readdir(path.resolve(pagesFolder, pageName)));\n\n        if (pageDirEntries.has('page.yml')) {\n          const ymlFilePath = path.resolve(pagesFolder, pageName, './page.yml');\n          const ymlContent = await readMaybeFile(ymlFilePath);\n\n          if (ymlContent) {\n            let parsedFile: Page | undefined;\n            try {\n              parsedFile = yaml.parse(ymlContent);\n            } catch (rawError) {\n              const error = errorFrom(rawError);\n\n              console.error(\n                `${chalk.red('error')} - Failed to read page ${chalk.cyan(pageName)}. ${\n                  error.message\n                }`,\n              );\n\n              return null;\n            }\n\n            const result = pageSchema.safeParse(parsedFile);\n\n            if (result.success) {\n              return [pageName, result.data];\n            }\n\n            console.error(\n              `${chalk.red('error')} - Failed to read page ${chalk.cyan(pageName)}. ${fromZodError(\n                result.error,\n              )}`,\n            );\n          }\n        }\n      }\n\n      return null;\n    }),\n  );\n\n  return Object.fromEntries(resultEntries.filter(Boolean));\n}\n\nasync function loadObjectFromFile<T extends z.ZodType>(\n  filePath: string,\n  schema: T,\n): Promise<z.infer<T> | null> {\n  const content = await readMaybeFile(filePath);\n  if (content) {\n    const parsedFile = yaml.parse(content);\n    const result = schema.safeParse(parsedFile);\n    if (result.success) {\n      return result.data;\n    }\n\n    console.error(\n      `${chalk.red('error')} - Failed to read theme ${chalk.cyan(filePath)}. ${fromZodError(\n        result.error,\n      )}`,\n    );\n\n    return null;\n  }\n  return null;\n}\n\nasync function loadThemeFromFile(root: string): Promise<Theme | null> {\n  const themeFilePath = getThemeFile(root);\n  return loadObjectFromFile(themeFilePath, themeSchema);\n}\n\nasync function loadApplicationFromFile(root: string): Promise<Application | null> {\n  const applicationFilePath = getApplicationFile(root);\n  return loadObjectFromFile(applicationFilePath, applicationSchema);\n}\n\nasync function createDefaultCodeComponent(name: string, filePath: string): Promise<string> {\n  const componentId = name.replace(/\\s/g, '');\n  const propTypeId = `${componentId}Props`;\n  const result = await format(\n    `\n  import * as React from 'react';\n  import { createComponent } from '@toolpad/studio/browser';\n  \n  export interface ${propTypeId} {\n    msg: string;\n  }\n  \n  function ${componentId}({ msg }: ${propTypeId}) {\n    return (\n      <div>{msg}</div>\n    );\n  }\n\n  export default createComponent(${componentId}, {\n    argTypes: {\n      msg: {\n        type: \"string\",\n        default: \"Hello world!\"\n      },\n    },\n  });    \n`,\n    filePath,\n  );\n  return result;\n}\n\nclass Lock {\n  pending: Promise<any> | null = null;\n\n  async use<T = void>(doWork: () => Promise<T>): Promise<T> {\n    try {\n      this.pending = Promise.resolve(this.pending).then(() => doWork());\n      return await this.pending;\n    } finally {\n      this.pending = null;\n    }\n  }\n}\n\nconst buildInfoSchema = z.object({\n  timestamp: z.number(),\n  base: z.string().optional(),\n});\n\ntype BuildInfo = z.infer<typeof buildInfoSchema>;\n\nconst DEFAULT_GENERATED_GITIGNORE_FILE_CONTENT = '.generated\\n';\n\nasync function initGitignore(root: string) {\n  const generatedGitignorePath = path.resolve(root, '.gitignore');\n  if (!(await fileExists(generatedGitignorePath))) {\n    // eslint-disable-next-line no-console\n    console.log(`${chalk.blue('info')}  - Initializing .gitignore file`);\n    await writeFileRecursive(generatedGitignorePath, DEFAULT_GENERATED_GITIGNORE_FILE_CONTENT, {\n      encoding: 'utf-8',\n    });\n  }\n}\n\nfunction mergeThemeIntoAppDom(dom: appDom.AppDom, themeFile: Theme): appDom.AppDom {\n  const themeFileSpec = themeFile.spec;\n  const app = appDom.getApp(dom);\n  dom = appDom.addNode(\n    dom,\n    appDom.createNode(dom, 'theme', {\n      theme: themeFileSpec?.options,\n      attributes: {},\n    }),\n    app,\n    'themes',\n  );\n  return dom;\n}\n\nfunction mergeApplicationIntoDom(dom: appDom.AppDom, applicationFile: Application): appDom.AppDom {\n  const applicationFileSpec = applicationFile.spec;\n  const app = appDom.getApp(dom);\n\n  dom = appDom.setNodeNamespacedProp(dom, app, 'attributes', 'plan', applicationFileSpec?.plan);\n\n  dom = appDom.setNodeNamespacedProp(dom, app, 'attributes', 'authentication', {\n    ...applicationFileSpec?.authentication,\n  });\n\n  dom = appDom.setNodeNamespacedProp(dom, app, 'attributes', 'authorization', {\n    ...applicationFileSpec?.authorization,\n    roles: applicationFileSpec?.authorization?.roles?.map((role) =>\n      typeof role === 'string' ? { name: role } : role,\n    ),\n  });\n\n  return dom;\n}\n\nfunction stringOnly(maybeString: unknown): string | undefined {\n  return typeof maybeString === 'string' ? maybeString : undefined;\n}\n\nfunction expandChildren(children: appDom.ElementNode[], dom: appDom.AppDom): ElementType[];\nfunction expandChildren(children: appDom.QueryNode[], dom: appDom.AppDom): Query[];\nfunction expandChildren<N extends appDom.AppDomNode>(\n  children: N[],\n  dom: appDom.AppDom,\n): (Query | ElementType)[];\nfunction expandChildren<N extends appDom.AppDomNode>(children: N[], dom: appDom.AppDom) {\n  return children\n    .sort((child1, child2) => {\n      invariant(child1.parentIndex && child2.parentIndex, 'Nodes are not children of another node');\n      return appDom.compareFractionalIndex(child1.parentIndex, child2.parentIndex);\n    })\n    .map((child) => expandFromDom(child, dom));\n}\n\nfunction undefinedWhenEmpty<O extends object | any[]>(obj?: O): O | undefined {\n  if (!obj || Object.values(obj).every((property) => property === undefined)) {\n    return undefined;\n  }\n  return obj;\n}\n\nfunction createPageFileQueryFromDomQuery(\n  dataSource: string,\n  query: FetchQuery | LocalQuery | undefined,\n): QueryConfig {\n  switch (dataSource) {\n    case 'rest': {\n      if (!query) {\n        return { kind: 'rest' };\n      }\n      query = query as FetchQuery;\n\n      let body: FetchBody | undefined;\n\n      if (query.body) {\n        switch (query.body.kind) {\n          case 'raw': {\n            body = {\n              kind: 'raw',\n              content: query.body.content as PropBindableAttrValue<string>,\n              contentType: query.body.contentType,\n            };\n            break;\n          }\n          case 'urlEncoded': {\n            body = {\n              kind: 'urlEncoded',\n              content: query.body.content.map(([name, value]) => ({\n                name,\n                value: value as PropBindableAttrValue<string>,\n              })),\n            };\n            break;\n          }\n          default:\n            throw new Error(`Unrecognized body kind \"${(query.body as any).kind}\"`);\n        }\n      }\n\n      let response: ResponseType | undefined;\n\n      if (query.response) {\n        switch (query.response.kind) {\n          case 'csv': {\n            response = { kind: 'csv', headers: query.response.headers };\n            break;\n          }\n          case 'json': {\n            response = { kind: 'json' };\n            break;\n          }\n          case 'xml': {\n            response = { kind: 'xml' };\n            break;\n          }\n          case 'raw': {\n            response = { kind: 'raw' };\n            break;\n          }\n          default:\n            throw new Error(`Unrecognized response kind \"${(query.response as any).kind}\"`);\n        }\n      }\n\n      return {\n        kind: 'rest',\n        url: query.url as PropBindableAttrValue<string>,\n        searchParams: query.searchParams?.map(([name, value]) => ({\n          name,\n          value: value as PropBindableAttrValue<string>,\n        })),\n        headers: query.headers.map(([name, value]) => ({\n          name,\n          value: value as PropBindableAttrValue<string>,\n        })),\n        body,\n        method: query.method,\n        response,\n        transform: query.transform,\n        transformEnabled: query.transformEnabled,\n      } satisfies FetchQueryConfig;\n    }\n    case 'local':\n      if (!query) {\n        return { kind: 'local' };\n      }\n\n      query = query as LocalQuery;\n      return {\n        function: query.function,\n        kind: 'local',\n      } satisfies LocalQueryConfig;\n    default:\n      throw new Error(`Unsupported dataSource \"${dataSource}\"`);\n  }\n}\n\nfunction expandFromDom(node: appDom.ElementNode, dom: appDom.AppDom): ElementType;\nfunction expandFromDom(node: appDom.QueryNode, dom: appDom.AppDom): Query;\nfunction expandFromDom(node: appDom.PageNode, dom: appDom.AppDom): Page;\nfunction expandFromDom<N extends appDom.AppDomNode>(\n  node: N,\n  dom: appDom.AppDom,\n): Page | Query | ElementType;\nfunction expandFromDom<N extends appDom.AppDomNode>(\n  node: N,\n  dom: appDom.AppDom,\n): Page | Query | ElementType {\n  if (appDom.isPage(node)) {\n    const children = appDom.getChildNodes(dom, node);\n\n    return {\n      apiVersion: API_VERSION,\n      kind: 'page',\n      spec: {\n        displayName: node.attributes.displayName,\n        alias: node.attributes.alias,\n        title: node.attributes.title,\n        parameters: undefinedWhenEmpty(\n          node.attributes.parameters?.map(([name, value]) => ({ name, value })) ?? [],\n        ),\n        content: undefinedWhenEmpty(expandChildren(children.children || [], dom)),\n        queries: undefinedWhenEmpty(expandChildren(children.queries || [], dom)),\n        display: node.attributes.display,\n        maxWidth: node.attributes.maxWidth,\n        authorization: node.attributes.authorization,\n      },\n    } satisfies Page;\n  }\n\n  if (appDom.isQuery(node)) {\n    return {\n      name: node.name,\n      enabled: node.attributes.enabled as PropBindableAttrValue<boolean>,\n      mode: node.attributes.mode,\n      query: node.attributes.dataSource\n        ? createPageFileQueryFromDomQuery(\n            node.attributes.dataSource,\n            node.attributes.query as FetchQuery | LocalQuery | undefined,\n          )\n        : undefined,\n      parameters: undefinedWhenEmpty(node.params?.map(([name, value]) => ({ name, value }))),\n      cacheTime: node.attributes.cacheTime,\n      refetchInterval: node.attributes.refetchInterval,\n      transform: node.attributes.transform,\n      transformEnabled: node.attributes.transformEnabled,\n    } satisfies Query;\n  }\n\n  if (appDom.isElement(node)) {\n    const { children, ...templates } = appDom.getChildNodes(dom, node);\n\n    const templateProps = mapValues(templates, (subtree) =>\n      subtree\n        ? {\n            $$template: expandChildren(subtree, dom),\n          }\n        : undefined,\n    );\n\n    return {\n      component: node.attributes.component,\n      name: node.name,\n      layout: undefinedWhenEmpty({\n        columnSize: node.layout?.columnSize,\n        height: node.layout?.height,\n        horizontalAlign: stringOnly(node.layout?.horizontalAlign),\n        verticalAlign: stringOnly(node.layout?.verticalAlign),\n      }),\n      props: undefinedWhenEmpty({ ...node.props, ...templateProps }),\n      children: undefinedWhenEmpty(expandChildren(children || [], dom)),\n    } satisfies ElementType;\n  }\n\n  throw new Error(`Unsupported node type \"${node.type}\"`);\n}\n\nfunction isTemplate(bindableProp?: BindableProp): bindableProp is Template {\n  return !!(\n    bindableProp &&\n    typeof bindableProp === 'object' &&\n    hasOwnProperty(bindableProp, '$$template')\n  );\n}\n\nfunction mergeElementIntoDom(\n  dom: appDom.AppDom,\n  parent: appDom.ElementNode | appDom.PageNode,\n  parentProp: string,\n  elm: ElementType,\n): appDom.AppDom {\n  const plainProps = filterValues(elm.props ?? {}, (prop) => !isTemplate(prop)) as Record<\n    string,\n    Exclude<BindableProp, Template>\n  >;\n\n  const templateProps = filterValues(elm.props ?? {}, isTemplate) as Record<string, Template>;\n\n  const elmNode = appDom.createElement(dom, elm.component, plainProps, elm.layout ?? {}, elm.name);\n\n  dom = appDom.addNode(dom, elmNode, parent, parentProp as any);\n\n  if (elm.children) {\n    for (const child of elm.children) {\n      dom = mergeElementIntoDom(dom, elmNode, 'children', child);\n    }\n  }\n\n  for (const [propName, templateProp] of Object.entries(templateProps)) {\n    for (const child of templateProp.$$template) {\n      dom = mergeElementIntoDom(dom, elmNode, propName, child);\n    }\n  }\n\n  return dom;\n}\n\nfunction createDomQueryFromPageFileQuery(query: QueryConfig): FetchQuery | LocalQuery {\n  switch (query.kind) {\n    case 'local':\n      return {\n        function: query.function,\n      } satisfies LocalQuery;\n    case 'rest': {\n      let body: AppDomFetchBody | undefined;\n\n      if (query.body) {\n        switch (query.body.kind) {\n          case 'raw': {\n            body = {\n              kind: 'raw',\n              content: query.body.content,\n              contentType: query.body.contentType,\n            };\n            break;\n          }\n          case 'urlEncoded': {\n            body = {\n              kind: 'urlEncoded',\n              content: query.body.content.map(({ name, value }) => [\n                name,\n                value as PropBindableAttrValue<string>,\n              ]),\n            };\n            break;\n          }\n          default:\n            throw new Error(`Unrecognized body kind \"${(query.body as any).kind}\"`);\n        }\n      }\n\n      let response: AppDomRestResponseType | undefined;\n\n      if (query.response) {\n        switch (query.response.kind) {\n          case 'csv': {\n            response = { kind: 'csv', headers: query.response.headers };\n            break;\n          }\n          case 'json': {\n            response = { kind: 'json' };\n            break;\n          }\n          case 'xml': {\n            response = { kind: 'xml' };\n            break;\n          }\n          case 'raw': {\n            response = { kind: 'raw' };\n            break;\n          }\n          default:\n            throw new Error(`Unrecognized response kind \"${(query.response as any).kind}\"`);\n        }\n      }\n\n      return {\n        url: query.url || undefined,\n        headers: query.headers?.map(({ name, value }) => [name, value]) || [],\n        method: query.method || 'GET',\n        browser: false,\n        transform: query.transform,\n        transformEnabled: query.transformEnabled,\n        searchParams: query.searchParams?.map(({ name, value }) => [name, value]) || [],\n        body,\n        response,\n      } satisfies FetchQuery;\n    }\n    default:\n      throw new Error(`Unrecognized query kind \"${(query as any).kind}\"`);\n  }\n}\n\nfunction createPageDomFromPageFile(pageName: string, pageFile: Page): appDom.AppDom {\n  const pageFileSpec = pageFile.spec ?? {};\n\n  let fragment = appDom.createFragment('page', {\n    name: pageName,\n    attributes: {\n      displayName: pageFileSpec.displayName,\n      // Convert deprecated id to alias\n      alias: pageFileSpec.id ? [pageFileSpec.id] : pageFileSpec.alias,\n      title: pageFileSpec.title,\n      parameters: pageFileSpec.parameters?.map(({ name, value }) => [name, value]) || [],\n      display: pageFileSpec.display || undefined,\n      maxWidth: pageFileSpec.maxWidth || undefined,\n      authorization: pageFileSpec.authorization || undefined,\n    },\n  });\n\n  const pageNode = appDom.getRoot(fragment);\n  appDom.assertIsPage(pageNode);\n\n  if (pageFileSpec.queries) {\n    for (const query of pageFileSpec.queries) {\n      if (query.query) {\n        const queryNode = appDom.createNode(fragment, 'query', {\n          name: query.name,\n          attributes: {\n            connectionId: null,\n            dataSource: typeof query.query?.kind === 'string' ? query.query.kind : undefined,\n            query: createDomQueryFromPageFileQuery(query.query),\n            cacheTime: typeof query.cacheTime === 'number' ? query.cacheTime : undefined,\n            enabled: query.enabled ?? undefined,\n            mode: typeof query.mode === 'string' ? query.mode : undefined,\n            transform: typeof query.transform === 'string' ? query.transform : undefined,\n            refetchInterval:\n              typeof query.refetchInterval === 'number' ? query.refetchInterval : undefined,\n            transformEnabled: query.transformEnabled ?? undefined,\n          },\n          params: query.parameters?.map(\n            ({ name, value }) => [name, value] satisfies [string, BindableAttrValue<any>],\n          ),\n        });\n        fragment = appDom.addNode(fragment, queryNode, pageNode, 'queries');\n      }\n    }\n  }\n\n  if (pageFileSpec.content) {\n    for (const child of pageFileSpec.content) {\n      fragment = mergeElementIntoDom(fragment, pageNode, 'children', child);\n    }\n  }\n\n  return fragment;\n}\n\nfunction mergePageIntoDom(dom: appDom.AppDom, pageName: string, pageFile: Page): appDom.AppDom {\n  const appRoot = appDom.getRoot(dom);\n  const pageFragment = createPageDomFromPageFile(pageName, pageFile);\n\n  const newPageNode = appDom.getRoot(pageFragment);\n\n  if (appDom.getMaybeNode(dom, newPageNode.id)) {\n    dom = appDom.removeNode(dom, newPageNode.id);\n  }\n\n  dom = appDom.addFragment(dom, pageFragment, appRoot.id, 'pages');\n\n  return dom;\n}\n\nfunction optimizePageElement(\n  element: ElementType,\n  isPageChild = false,\n): ElementType | ElementType[] {\n  if (isPageChild && element.component === PAGE_COLUMN_COMPONENT_ID) {\n    return (element.children || []).flatMap((child) => optimizePageElement(child, true));\n  }\n\n  const isLayoutElement = (possibleLayoutElement: ElementType): boolean =>\n    possibleLayoutElement.component === PAGE_ROW_COMPONENT_ID ||\n    possibleLayoutElement.component === PAGE_COLUMN_COMPONENT_ID;\n\n  if (isLayoutElement(element) && element.children?.length === 1) {\n    const onlyChild = element.children[0];\n\n    if (!isLayoutElement(onlyChild)) {\n      return optimizePageElement({\n        ...onlyChild,\n        layout: {\n          ...onlyChild.layout,\n          columnSize: 1,\n        },\n      });\n    }\n  }\n\n  return {\n    ...element,\n    children: element.children && element.children.flatMap((child) => optimizePageElement(child)),\n  };\n}\n\nfunction optimizePage(page: Page): Page {\n  return {\n    ...page,\n    spec: {\n      ...page.spec,\n      content: page.spec?.content?.flatMap((element) => optimizePageElement(element, true)),\n    },\n  };\n}\n\nfunction mergePagesIntoDom(dom: appDom.AppDom, pages: PagesContent): appDom.AppDom {\n  for (const [name, page] of Object.entries(pages)) {\n    dom = mergePageIntoDom(dom, name, optimizePage(page));\n  }\n  return dom;\n}\n\ntype PagesContent = Record<string, Page>;\n\ninterface ExtractedPages {\n  pages: PagesContent;\n  dom: appDom.AppDom;\n}\n\nfunction extractPagesFromDom(dom: appDom.AppDom): ExtractedPages {\n  const rootNode = appDom.getApp(dom);\n  const { pages: pageNodes = [] } = appDom.getChildNodes(dom, rootNode);\n\n  const pages: PagesContent = {};\n\n  for (const pageNode of pageNodes) {\n    pages[pageNode.name] = expandFromDom(pageNode, dom);\n    dom = appDom.removeNode(dom, pageNode.id);\n  }\n\n  return { pages, dom };\n}\n\nfunction extractThemeFromDom(dom: appDom.AppDom): Theme | null {\n  const rootNode = appDom.getApp(dom);\n  const { themes: themeNodes = [] } = appDom.getChildNodes(dom, rootNode);\n  if (themeNodes.length > 0) {\n    return {\n      apiVersion: API_VERSION,\n      kind: 'theme',\n      spec: {\n        options: themeNodes[0].theme,\n      },\n    };\n  }\n\n  return null;\n}\n\nfunction extractApplicationFromDom(dom: appDom.AppDom): Application | null {\n  const rootNode = appDom.getApp(dom);\n  return {\n    apiVersion: API_VERSION,\n    kind: 'application',\n    spec: {\n      plan: rootNode.attributes.plan,\n      authentication: rootNode.attributes.authentication,\n      authorization: rootNode.attributes.authorization,\n    },\n  };\n}\n\nfunction getSchemaUrl(obj: string) {\n  return `https://raw.githubusercontent.com/mui/toolpad/v${packageInfo.version}/docs/schemas/v1/definitions.json#properties/${obj}`;\n}\n\nasync function writePagesToFiles(root: string, pages: PagesContent) {\n  await Promise.all(\n    Object.entries(pages).map(async ([name, page]) => {\n      const pageFileName = getPageFile(root, name);\n      await updateYamlFile(pageFileName, optimizePage(page), {\n        schemaUrl: getSchemaUrl('Page'),\n      });\n    }),\n  );\n}\n\nasync function writeThemeFile(root: string, theme: Theme | null) {\n  const themeFilePath = getThemeFile(root);\n  if (theme) {\n    await updateYamlFile(themeFilePath, theme, {\n      schemaUrl: getSchemaUrl('Theme'),\n    });\n  } else {\n    await fs.rm(themeFilePath, { recursive: true, force: true });\n  }\n}\n\nasync function writeApplicationFile(root: string, application: Application | null) {\n  const applicationFilePath = getApplicationFile(root);\n  if (application) {\n    await updateYamlFile(applicationFilePath, application, {\n      schemaUrl: getSchemaUrl('Application'),\n    });\n  } else {\n    await fs.rm(applicationFilePath, { recursive: true, force: true });\n  }\n}\n\nasync function writeDomToDisk(root: string, dom: appDom.AppDom): Promise<void> {\n  const { pages: pagesContent } = extractPagesFromDom(dom);\n  await Promise.all([\n    writePagesToFiles(root, pagesContent),\n    writeThemeFile(root, extractThemeFromDom(dom)),\n    writeApplicationFile(root, extractApplicationFromDom(dom)),\n  ]);\n}\n\nexport async function findSupportedEditor(): Promise<string | undefined> {\n  if (process.env.EDITOR) {\n    return undefined;\n  }\n  try {\n    await execa('code', ['-v']);\n    return 'code';\n  } catch (err) {\n    return undefined;\n  }\n}\n\nexport type ProjectFolderEntry = {\n  name: string;\n  kind: 'query';\n  filepath: string;\n};\n\ninterface ToolpadProjectFolder {\n  application: Application | null;\n  pages: Record<string, Page>;\n  theme: Theme | null;\n}\n\nasync function readProjectFolder(root: string): Promise<ToolpadProjectFolder> {\n  const [pagesContent, theme, application] = await Promise.all([\n    loadPagesFromFiles(root),\n    loadThemeFromFile(root),\n    loadApplicationFromFile(root),\n  ]);\n\n  return {\n    application,\n    pages: pagesContent,\n    theme,\n  };\n}\n\nasync function writeProjectFolder(root: string, folder: ToolpadProjectFolder): Promise<void> {\n  await Promise.all([\n    writePagesToFiles(root, folder.pages),\n    writeThemeFile(root, folder.theme),\n    writeApplicationFile(root, folder.application),\n  ]);\n}\n\nfunction projectFolderToAppDom(projectFolder: ToolpadProjectFolder): appDom.AppDom {\n  let dom = appDom.createDom();\n  dom = mergePagesIntoDom(dom, projectFolder.pages);\n  if (projectFolder.theme) {\n    dom = mergeThemeIntoAppDom(dom, projectFolder.theme);\n  }\n  if (projectFolder.application) {\n    dom = mergeApplicationIntoDom(dom, projectFolder.application);\n  }\n  return dom;\n}\n\nasync function loadProjectFolder(root: string): Promise<ToolpadProjectFolder> {\n  return readProjectFolder(root);\n}\n\nasync function loadDomFromDisk(root: string): Promise<appDom.AppDom> {\n  const projectFolder = await loadProjectFolder(root);\n\n  return projectFolderToAppDom(projectFolder);\n}\n\nfunction getDomFilePatterns(root: string) {\n  return [\n    path.resolve(root, './pages/*/page.yml'),\n    path.resolve(root, './theme.yml'),\n    path.resolve(root, './application.yml'),\n  ];\n}\n/**\n * Calculates a fingerprint from all files that influence the dom structure\n */\nasync function calculateDomFingerprint(root: string): Promise<number> {\n  const files = await glob(getDomFilePatterns(root), { windowsPathsNoEscape: true });\n\n  const mtimes = await Promise.all(\n    files.sort().map(async (file) => {\n      const stats = await fs.stat(file);\n      return [file, stats.mtimeMs];\n    }),\n  );\n\n  return insecureHash(JSON.stringify(mtimes));\n}\n\nfunction findEnvBindings(obj: unknown): EnvAttrValue[] {\n  if (Array.isArray(obj)) {\n    return obj.flatMap((item) => findEnvBindings(item));\n  }\n\n  if (obj && typeof obj === 'object') {\n    try {\n      return [envBindingSchema.parse(obj)];\n    } catch {\n      return Object.values(obj).flatMap((value) => findEnvBindings(value));\n    }\n  }\n\n  return [];\n}\n\nexport function getRequiredEnvVars(dom: appDom.AppDom): Set<string> {\n  const allVars = Object.values(dom.nodes)\n    .flatMap((node) => findEnvBindings(node))\n    .map((binding) => binding.$$env);\n\n  return new Set(allVars);\n}\n\nconst PRO_AUTH_PROVIDERS = ['azure-ad'];\n\ninterface PaidFeature {\n  id: string;\n  label: string;\n}\n\nfunction detectPaidFeatures(application: Application): PaidFeature[] | null {\n  if (!application.spec || !application.spec.authorization) {\n    return null;\n  }\n\n  const hasRoles = Boolean(application?.spec?.authorization?.roles);\n  const hasProAuthProvider = application?.spec?.authentication?.providers?.some((elems) =>\n    PRO_AUTH_PROVIDERS.includes(elems.provider),\n  );\n  const paidFeatures = [\n    hasRoles ? { id: 'roles', label: 'Role-based access control' } : undefined,\n    hasProAuthProvider\n      ? { id: 'pro-auth-provider', label: 'Some of your active authentication providers' }\n      : undefined,\n  ].filter(Boolean) as PaidFeature[];\n  return paidFeatures.length > 0 ? paidFeatures : null;\n}\n\nclass ToolpadProject {\n  private root: string;\n\n  events = new Emitter<ProjectEvents>();\n\n  private domAndFingerprint: Awaitable<[appDom.AppDom, number]> | null = null;\n\n  private domAndFingerprintLock = new Lock();\n\n  options: ToolpadProjectOptions;\n\n  envManager: EnvManager;\n\n  functionsManager: FunctionsManager;\n\n  dataManager: DataManager;\n\n  private alertedMissingVars = new Set<string>();\n\n  private lastVersionCheck = 0;\n\n  private pendingVersionCheck: Promise<VersionInfo> | undefined;\n\n  private componentsManifestPromise: Promise<ComponentsManifest> | undefined;\n\n  private pagesManifestPromise: Promise<PagesManifest> | undefined;\n\n  constructor(root: string, options: ToolpadProjectOptions) {\n    invariant(\n      // eslint-disable-next-line no-underscore-dangle\n      !global.__toolpadProjects?.has(root),\n      `A project is already running for \"${root}\"`,\n    );\n    // eslint-disable-next-line no-underscore-dangle\n    global.__toolpadProjects ??= new Set();\n    // eslint-disable-next-line no-underscore-dangle\n    global.__toolpadProjects.add(root);\n\n    this.root = root;\n    this.options = options;\n\n    this.envManager = new EnvManager(this);\n    this.functionsManager = new FunctionsManager(this);\n    this.dataManager = new DataManager(this);\n\n    const invalidateQueries = throttle(\n      () => {\n        this.events.emit('queriesInvalidated', {});\n      },\n      250,\n      {\n        leading: false,\n      },\n    );\n\n    this.events.on('functionsChanged', invalidateQueries);\n    this.events.on('envChanged', invalidateQueries);\n  }\n\n  private initWatcher() {\n    if (!this.options.dev) {\n      return;\n    }\n\n    const updateDomFromExternal = debounce(() => {\n      this.domAndFingerprintLock.use(async () => {\n        const [, fingerprint] = await this.loadDomAndFingerprint();\n        const newFingerprint = await calculateDomFingerprint(this.root);\n        if (fingerprint !== newFingerprint) {\n          // eslint-disable-next-line no-console\n          console.log(`${chalk.magenta('event')} - Project changed on disk, updating...`);\n          this.domAndFingerprint = await Promise.all([\n            loadDomFromDisk(this.root),\n            calculateDomFingerprint(this.root),\n          ]);\n          this.events.emit('change', {});\n          this.events.emit('externalChange', {});\n        }\n      });\n    }, 100);\n\n    const watchOptions: chokidar.WatchOptions = {\n      // This is needed to correctly pick up page folder renames\n      // Remove this once https://github.com/paulmillr/chokidar/issues/1285 gets resolved\n      usePolling: true,\n    };\n\n    chokidar.watch(getDomFilePatterns(this.root), watchOptions).on('all', () => {\n      updateDomFromExternal();\n    });\n\n    const handleComponentFileChange = async () => {\n      const oldManifest = await this.componentsManifestPromise;\n      this.componentsManifestPromise = this.buildComponentsManifest();\n      const newManifest = await this.componentsManifestPromise;\n      if (JSON.stringify(oldManifest) !== JSON.stringify(newManifest)) {\n        this.events.emit('componentsListChanged', {});\n      }\n    };\n\n    chokidar\n      .watch(\n        [path.resolve(this.root, './components'), path.resolve(this.root, './components/*.*')],\n        watchOptions,\n      )\n      .on('add', handleComponentFileChange)\n      .on('addDir', handleComponentFileChange)\n      .on('unlink', handleComponentFileChange)\n      .on('unlinkDir', handleComponentFileChange);\n\n    const handlePageFileChange = async () => {\n      const oldManifest = await this.pagesManifestPromise;\n      this.pagesManifestPromise = buildPagesManifest(this.root);\n      const newManifest = await this.pagesManifestPromise;\n      if (JSON.stringify(oldManifest) !== JSON.stringify(newManifest)) {\n        this.events.emit('pagesManifestChanged', {});\n      }\n    };\n\n    chokidar\n      .watch(\n        [path.resolve(this.root, './pages'), path.resolve(this.root, './pages/*/page.*')],\n        watchOptions,\n      )\n      .on('add', handlePageFileChange)\n      .on('addDir', handlePageFileChange)\n      .on('unlink', handlePageFileChange)\n      .on('unlinkDir', handlePageFileChange);\n  }\n\n  private async loadDomAndFingerprint() {\n    if (!this.domAndFingerprint) {\n      this.domAndFingerprint = Promise.all([\n        loadDomFromDisk(this.root),\n        calculateDomFingerprint(this.root),\n      ]);\n    }\n    return this.domAndFingerprint;\n  }\n\n  getRoot() {\n    return this.root;\n  }\n\n  getOutputFolder() {\n    return getOutputFolder(this.getRoot());\n  }\n\n  getAppOutputFolder() {\n    return getAppOutputFolder(this.getRoot());\n  }\n\n  getBuildInfoFile() {\n    return path.resolve(this.getOutputFolder(), 'buildInfo.json');\n  }\n\n  alertOnMissingVariablesInDom(dom: appDom.AppDom) {\n    const requiredVars = getRequiredEnvVars(dom);\n    const missingVars = Array.from(requiredVars).filter(\n      (key) => typeof process.env[key] === 'undefined',\n    );\n    const toAlert = missingVars.filter((key) => !this.alertedMissingVars.has(key));\n\n    if (toAlert.length > 0) {\n      const firstThree = toAlert.slice(0, 3);\n      const restCount = toAlert.length - firstThree.length;\n      const missingListMsg = firstThree.map((varName) => chalk.cyan(varName)).join(', ');\n      const restMsg = restCount > 0 ? ` and ${restCount} more` : '';\n\n      // eslint-disable-next-line no-console\n      console.log(\n        `${chalk.yellow(\n          'warn',\n        )}  - Missing required environment variable(s): ${missingListMsg}${restMsg}.`,\n      );\n    }\n\n    // Only alert once per missing variable\n    this.alertedMissingVars = new Set(missingVars);\n  }\n\n  async checkPlan() {\n    const [dom] = await this.loadDomAndFingerprint();\n\n    const application = extractApplicationFromDom(dom);\n    if (!application || !application.spec) {\n      return;\n    }\n\n    if (!application.spec.plan || application.spec.plan === 'free') {\n      const paidFeatures = detectPaidFeatures(application);\n      if (paidFeatures) {\n        throw new Error(\n          `You are using ${chalk.bgBlue(paidFeatures.map((feature) => feature.label))} which ${paidFeatures.length > 1 ? 'are paid features' : 'is a paid feature'}. To continue using Toolpad, upgrade your plan or remove this feature. Learn more at ${chalk.cyan(UPGRADE_URL)}.`,\n        );\n      }\n    } else {\n      // eslint-disable-next-line no-console\n      console.log(\n        `${chalk.yellow(\n          'warn',\n        )}  - You are using features that ${chalk.bold('are not covered under our MIT License')}. You will have to buy a license to use them in production.`,\n      );\n    }\n  }\n\n  async start() {\n    if (this.options.dev) {\n      await this.resetBuildInfo();\n      await this.initWatcher();\n    } else {\n      const buildInfo = await this.getBuildInfo();\n      if (!buildInfo) {\n        throw new Error(`No production build found. Please run \"toolpad-studio build\" first.`);\n      }\n\n      if (buildInfo.base !== this.options.base) {\n        throw new Error(\n          `Production build found for base \"${buildInfo.base}\" but running the app with \"${this.options.base}\". Please run \"toolpad-studio build\" with the correct --base option.`,\n        );\n      }\n    }\n    await Promise.all([this.envManager.start(), this.functionsManager.start()]);\n  }\n\n  async build() {\n    await Promise.all([this.envManager.build(), this.functionsManager.build()]);\n  }\n\n  async dispose() {\n    await Promise.all([this.envManager.dispose(), this.functionsManager.dispose()]);\n    // eslint-disable-next-line no-underscore-dangle\n    global.__toolpadProjects?.delete(this.root);\n  }\n\n  async loadDom() {\n    const [dom] = await this.loadDomAndFingerprint();\n    this.alertOnMissingVariablesInDom(dom);\n    return dom;\n  }\n\n  async buildComponentsManifest(): Promise<ComponentsManifest> {\n    const componentsFolder = getComponentsFolder(this.getRoot());\n    const entries = await glob(['*.tsx'], { cwd: componentsFolder });\n    const result = entries.map((fileName) => {\n      const componentName = fileName.replace(/\\.tsx$/, '');\n      if (isValidJsIdentifier(componentName)) {\n        const filePath = path.resolve(componentsFolder, fileName);\n        return { name: componentName, path: filePath };\n      }\n      // eslint-disable-next-line no-console\n      console.log(`Invalid component name: ${componentName}`);\n      return null;\n    });\n    return result.filter(Boolean);\n  }\n\n  async getComponentsManifest(): Promise<ComponentsManifest> {\n    if (!this.componentsManifestPromise) {\n      this.componentsManifestPromise = this.buildComponentsManifest();\n    }\n    return this.componentsManifestPromise;\n  }\n\n  async writeDomToDisk(newDom: appDom.AppDom) {\n    if (!this.options.dev) {\n      throw new Error(`Writing to disk is only possible in Toolpad Studio dev mode.`);\n    }\n\n    await writeDomToDisk(this.root, newDom);\n    const newFingerprint = await calculateDomFingerprint(this.root);\n    this.domAndFingerprint = [newDom, newFingerprint];\n    this.events.emit('change', { fingerprint: newFingerprint });\n  }\n\n  async init() {\n    const projectFolder = await readProjectFolder(this.root);\n    if (Object.keys(projectFolder.pages).length <= 0) {\n      projectFolder.pages.page = {\n        apiVersion: API_VERSION,\n        kind: 'page',\n        spec: {\n          id: appDom.createId(),\n          title: 'Default page',\n        },\n      };\n      await writeProjectFolder(this.root, projectFolder);\n    }\n\n    await initGitignore(this.root);\n  }\n\n  async saveDom(newDom: appDom.AppDom) {\n    await this.domAndFingerprintLock.use(async () => {\n      return this.writeDomToDisk(newDom);\n    });\n  }\n\n  async applyDomDiff(domDiff: appDom.DomDiff) {\n    await this.domAndFingerprintLock.use(async () => {\n      const dom = await this.loadDom();\n      const newDom = appDom.applyDiff(dom, domDiff);\n      return this.writeDomToDisk(newDom);\n    });\n  }\n\n  async openCodeEditor(fileName: string, fileType: CodeEditorFileType) {\n    const supportedEditor = await findSupportedEditor();\n    const root = this.getRoot();\n    let resolvedPath = fileName;\n\n    if (fileType === 'resource') {\n      resolvedPath = await this.functionsManager.getFunctionFilePath(fileName);\n    }\n    if (fileType === 'component') {\n      const componentsFolder = getComponentsFolder(root);\n      resolvedPath = getComponentFilePath(componentsFolder, fileName);\n    }\n    const fullResolvedPath = path.resolve(root, resolvedPath);\n    await openEditor([fullResolvedPath, root], {\n      editor: supportedEditor,\n    });\n  }\n\n  async getVersionInfo(): Promise<VersionInfo> {\n    const now = Date.now();\n    if (!this.pendingVersionCheck || this.lastVersionCheck + VERSION_CHECK_INTERVAL <= now) {\n      this.lastVersionCheck = now;\n      this.pendingVersionCheck = checkVersion(this.root);\n    }\n\n    return this.pendingVersionCheck;\n  }\n\n  async createComponent(name: string) {\n    const componentsFolder = getComponentsFolder(this.root);\n    const filePath = getComponentFilePath(componentsFolder, name);\n    const content = await createDefaultCodeComponent(name, filePath);\n    await writeFileRecursive(filePath, content, { encoding: 'utf-8' });\n  }\n\n  async createDataProvider(name: string, options: CreateDataProviderOptions) {\n    return this.functionsManager.createDataProviderFile(name, options);\n  }\n\n  async deletePage(name: string) {\n    const pageFolder = getPageFolder(this.root, name);\n    await fs.rm(pageFolder, { force: true, recursive: true });\n  }\n\n  async getPrettierConfig() {\n    const root = this.getRoot();\n    const config = await resolvePrettierConfig(root);\n    return config;\n  }\n\n  async writeBuildInfo() {\n    await writeFileRecursive(\n      this.getBuildInfoFile(),\n      JSON.stringify({\n        timestamp: Date.now(),\n        base: this.options.base,\n      } satisfies BuildInfo),\n      { encoding: 'utf-8' },\n    );\n  }\n\n  async resetBuildInfo() {\n    await fs.rm(this.getBuildInfoFile(), { force: true, recursive: true });\n  }\n\n  async getBuildInfo(): Promise<BuildInfo | null> {\n    try {\n      const content = await readJsonFile(this.getBuildInfoFile());\n      return buildInfoSchema.parse(content);\n    } catch {\n      return null;\n    }\n  }\n\n  async getPagesManifest(): Promise<PagesManifest> {\n    if (!this.pagesManifestPromise) {\n      this.pagesManifestPromise = buildPagesManifest(this.root);\n    }\n    return this.pagesManifestPromise;\n  }\n}\n\nexport type { ToolpadProject };\n\nexport function resolveProjectDir(dir: string) {\n  const projectDir = path.resolve(process.cwd(), dir);\n  return projectDir;\n}\n\nexport interface InitProjectOptions extends Partial<ToolpadProjectOptions> {\n  dir: string;\n}\n\nexport async function initProject({ dir: dirInput, ...config }: InitProjectOptions) {\n  const dir = resolveProjectDir(dirInput);\n\n  const resolvedConfig: ToolpadProjectOptions = {\n    toolpadDevMode: false,\n    dev: false,\n    base: '/prod',\n    customServer: false,\n    ...config,\n  };\n\n  const project = new ToolpadProject(dir, resolvedConfig);\n\n  await project.init();\n\n  return project;\n}\n\nconst basePagesManifestEntrySchema = z.object({\n  slug: z.string(),\n  title: z.string(),\n  legacy: z.boolean().optional(),\n});\n\nexport interface PagesManifestEntry extends z.infer<typeof basePagesManifestEntrySchema> {\n  children: PagesManifestEntry[];\n}\n\nconst pagesManifestEntrySchema: z.ZodType<PagesManifestEntry> = basePagesManifestEntrySchema.extend(\n  {\n    children: z.array(z.lazy(() => pagesManifestEntrySchema)),\n  },\n);\n\nconst pagesManifestSchema = z.object({\n  pages: z.array(pagesManifestEntrySchema),\n});\n\nexport type PagesManifest = z.infer<typeof pagesManifestSchema>;\n\nasync function buildPagesManifest(root: string): Promise<PagesManifest> {\n  const pagesFolder = getPagesFolder(root);\n  const pageDirs = await readMaybeDir(pagesFolder);\n  const pages = (\n    await Promise.all(\n      pageDirs.map(async (page) => {\n        if (page.isDirectory()) {\n          const pagePath = path.resolve(pagesFolder, page.name);\n          const title = guessTitle(page.name);\n\n          const extensions = ['.tsx', '.jsx'];\n\n          for (const extension of extensions) {\n            const pageFilePath = path.resolve(pagePath, `page${extension}`);\n\n            // eslint-disable-next-line no-await-in-loop\n            const stat = await fs.stat(pageFilePath).catch(() => null);\n            if (stat?.isFile()) {\n              return [\n                {\n                  slug: page.name,\n                  title,\n                  children: [],\n                },\n              ];\n            }\n          }\n\n          const pageFilePath = path.resolve(pagePath, 'page.yml');\n\n          const stat = await fs.stat(pageFilePath).catch(() => null);\n          if (stat?.isFile()) {\n            return [\n              {\n                slug: page.name,\n                title,\n                legacy: true,\n                children: [],\n              },\n            ];\n          }\n        }\n\n        return [];\n      }),\n    )\n  ).flat();\n\n  pages.sort((page1, page2) => page1.title.localeCompare(page2.title));\n\n  return { pages };\n}\n\nexport async function loadDom(root: string) {\n  const resolvedRoot = resolveProjectDir(root);\n  return loadDomFromDisk(resolvedRoot);\n}\n","/**\n * Returns a hash code for a string.\n * (Compatible to Java's String.hashCode())\n *\n * The hash code for a string object is computed as\n *     s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]\n * using number arithmetic, where s[i] is the i th character\n * of the given string, n is the length of the string,\n * and ^ indicates exponentiation.\n * (The hash value of the empty string is zero.)\n *\n * Do not use in a security critical context.\n *\n * @see https://gist.github.com/hyamamoto/fd435505d29ebfa3d9716fd2be8d42f0\n */\nexport default function insecureHash(str: string) {\n  let h = 0;\n  for (let i = 0; i < str.length; i += 1) {\n    // eslint-disable-next-line no-bitwise\n    h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;\n  }\n  return h;\n}\n","import { SimplePaletteColorOptions, ThemeOptions } from '@mui/material';\nimport { z } from 'zod';\n\nexport const API_VERSION = 'v1';\n\nfunction toolpadObjectSchema<K extends string, T extends z.ZodType>(kind: K, spec: T) {\n  return z.object({\n    apiVersion: z\n      .literal('v1')\n      .describe(\n        `Defines the version of this object. Used in determining compatibility between Toolpad Studio \"${kind}\" objects.`,\n      ),\n    kind: z.literal(kind).describe(`Describes the nature of this Toolpad Studio \"${kind}\" object.`),\n    spec: spec.optional().describe(`Defines the shape of this \"${kind}\" object`),\n  });\n}\n\nconst literalSchema = z.union([z.string(), z.number(), z.boolean(), z.null()]);\n\nfunction nameValuePairSchema<V extends z.ZodTypeAny>(valueType: V) {\n  return z\n    .object({\n      name: z.string().describe('The name'),\n      value: valueType.describe(valueType.description ?? 'The value'),\n    })\n    .describe('A name/value pair.');\n}\n\nexport const jsExpressionBindingSchema = z\n  .object({\n    $$jsExpression: z.string().describe('The expression to be evaluated.'),\n  })\n  .describe('A binding that evaluates an expression and returns the result.');\n\nexport const envBindingSchema = z\n  .object({\n    $$env: z.string().describe('The name of an environment variable.'),\n  })\n  .describe('An environment variable.');\n\nfunction bindableSchema<V extends z.ZodTypeAny>(valueType: V) {\n  return z.union([valueType, jsExpressionBindingSchema, envBindingSchema]);\n}\n\nconst jsExpressionActionSchema = z\n  .object({\n    $$jsExpressionAction: z.string().describe('The code to be executed.'),\n  })\n  .describe('A javascript expression to be executed when this action is triggered.');\n\nconst navigationActionSchema = z\n  .object({\n    $$navigationAction: z.object({\n      page: z.string().describe('The page that is being navigated to'),\n      parameters: z\n        .record(bindableSchema(z.any()))\n        .describe('Parameters to pass when navigating to this page'),\n    }),\n  })\n  .describe(\n    'A navigation from one page to another, optionally passing parameters to the next page.',\n  );\n\nexport type NavigationAction = z.infer<typeof navigationActionSchema>;\n\nconst fetchModeSchema = z.union([\n  z.literal('query').describe('Fetch automatically when the page opens'),\n  z.literal('mutation').describe('Fetch on manual action only'),\n]);\n\nconst nameStringValuePairSchema = nameValuePairSchema(z.string()).describe(\n  'a name/value pair with a string value.',\n);\n\nconst rawBodySchema = z.object({\n  kind: z.literal('raw'),\n  content: bindableSchema(z.string()),\n  contentType: z.string(),\n});\n\nconst bindableNameStringValueSchema = nameValuePairSchema(bindableSchema(z.string())).describe(\n  'A name/value pair where the value is dynamically bindable to strings.',\n);\n\nconst urlEncodedBodySchema = z.object({\n  kind: z.literal('urlEncoded'),\n  content: z.array(bindableNameStringValueSchema),\n});\n\nconst fetchBodySchema = z.discriminatedUnion('kind', [rawBodySchema, urlEncodedBodySchema]);\n\nexport type FetchBody = z.infer<typeof fetchBodySchema>;\n\nconst rawResponseTypeSchema = z\n  .object({\n    kind: z.literal('raw'),\n  })\n  .describe(\"Don't interpret this body at all.\");\n\nconst jsonResponseTypeSchema = z\n  .object({\n    kind: z.literal('json'),\n  })\n  .describe('Interpret the fetch response as JSON');\n\nconst csvResponseTypeSchema = z\n  .object({\n    kind: z.literal('csv'),\n    headers: z.boolean().describe('First row contains headers'),\n  })\n  .describe('Interpret the fetch response as CSV');\n\nconst xmlResponseTypeSchema = z\n  .object({\n    kind: z.literal('xml'),\n  })\n  .describe('Interpret the fetch response as XML');\n\nconst responseTypeSchema = z\n  .discriminatedUnion('kind', [\n    rawResponseTypeSchema,\n    jsonResponseTypeSchema,\n    csvResponseTypeSchema,\n    xmlResponseTypeSchema,\n  ])\n  .describe('Describes how a the fetch response is to be interpreted.');\n\nexport type ResponseType = z.infer<typeof responseTypeSchema>;\n\nconst fetchQueryConfigSchema = z.object({\n  kind: z.literal('rest').describe('Designates this object as a fetch query.'),\n  url: bindableSchema(z.string()).optional().describe('The URL of the request'),\n  method: z.string().optional().describe('The request method.'),\n  headers: z.array(bindableNameStringValueSchema).optional().describe('Extra request headers.'),\n  searchParams: z\n    .array(bindableNameStringValueSchema)\n    .optional()\n    .describe('Extra url query parameters.'),\n  body: fetchBodySchema.optional().describe('The request body.'),\n  transformEnabled: z.boolean().optional().describe('Run a custom transformer on the response.'),\n  transform: z.string().optional().describe('The custom transformer to run when enabled.'),\n  response: responseTypeSchema.optional().describe('How to parse the response.'),\n});\n\nexport type FetchQueryConfig = z.infer<typeof fetchQueryConfigSchema>;\n\nconst localQueryConfigSchema = z.object({\n  kind: z.literal('local').describe('Designates this object as a local function query.'),\n  function: z\n    .string()\n    .optional()\n    .describe('The function to be executed on the backend by this query.'),\n});\n\nexport type LocalQueryConfig = z.infer<typeof localQueryConfigSchema>;\n\nconst queryConfigSchema = z.discriminatedUnion('kind', [\n  fetchQueryConfigSchema,\n  localQueryConfigSchema,\n]);\n\nexport type QueryConfig = z.infer<typeof queryConfigSchema>;\n\nconst querySchema = z.object({\n  name: z.string().describe('A name for the query'),\n  enabled: bindableSchema(z.boolean())\n    .optional()\n    .describe(\n      \"Activates or deactivates the query. When deactivated the data won't be loaded when the page opens.\",\n    ),\n  parameters: z\n    .array(nameValuePairSchema(bindableSchema(z.any())))\n    .optional()\n    .describe('Parameters to pass to this query.'),\n  mode: fetchModeSchema.optional().describe('How to fetch this query.'),\n  query: queryConfigSchema.optional().describe('Query definition'),\n  transform: z.string().optional().describe('Transformation to run on the response'),\n  transformEnabled: z.boolean().optional().describe('Enable the transformation'),\n  refetchInterval: z.number().optional().describe('Interval to rerun this query at'),\n  cacheTime: z.number().optional().describe('Time to cache before refetching'),\n});\n\nexport type Query = z.infer<typeof querySchema>;\n\nexport type Template = {\n  $$template: ElementType[];\n};\n\nlet elementSchema: z.ZodType<ElementType>;\n\nconst templateSchema: z.ZodType<Template> = z\n  .object({\n    $$template: z\n      .lazy(() => z.array(elementSchema))\n      .describe('The subtree, that describes the UI to be rendered by the template.'),\n  })\n  .describe('Describes a fragment of Toolpad Studio elements, to be used as a template.');\n\nconst baseElementSchema = z.object({\n  component: z.string().describe('The component that this element was based on.'),\n  name: z\n    .string()\n    .describe('a name for this component, which is used to reference it inside bindings.'),\n  layout: z\n    .object({\n      horizontalAlign: z\n        .string()\n        .optional()\n        .describe('Lays out the element along the horizontal axis.'),\n      verticalAlign: z\n        .string()\n        .optional()\n        .describe('Lays out the element along the vertical axis.'),\n      columnSize: z\n        .number()\n        .optional()\n        .describe('The width this element takes up, expressed in terms of columns on the page.'),\n      height: z.number().optional().describe('The height this element takes up, in pixels.'),\n    })\n    .optional()\n    .describe('Layout properties for this element.'),\n});\n\ntype BaseElement = z.infer<typeof baseElementSchema>;\n\nexport const bindablePropSchema: z.ZodType = z.lazy(() =>\n  z.union([\n    ...literalSchema.options,\n    z.array(bindablePropSchema),\n    z.record(\n      z.string().refine((key) => !key.startsWith('$$')),\n      bindablePropSchema,\n    ),\n    jsExpressionBindingSchema,\n    envBindingSchema,\n    jsExpressionActionSchema,\n    navigationActionSchema,\n    templateSchema,\n  ]),\n);\n\nexport type BindableProp = z.infer<typeof bindablePropSchema>;\n\nexport type ElementType = BaseElement & {\n  children?: ElementType[];\n  props?: Record<string, BindableProp>;\n};\n\nelementSchema = baseElementSchema\n  .extend({\n    children: z\n      .lazy(() => z.array(elementSchema).optional())\n      .describe('The children of this element.'),\n    props: z\n      .lazy(() => z.record(bindablePropSchema).optional())\n      .describe('The properties to configure this instance of the component.'),\n  })\n  .describe('The instance of a component. Used to build user interfaces in pages.');\n\nexport const applicationSchema = toolpadObjectSchema(\n  'application',\n  z.object({\n    plan: z.enum(['free', 'pro']).optional().describe('The plan for this application.'),\n    authentication: z\n      .object({\n        providers: z\n          .array(\n            z.object({\n              provider: z\n                .enum(['github', 'google', 'azure-ad', 'credentials'])\n                .describe('Unique identifier for this authentication provider.'),\n              roles: z\n                .array(\n                  z.object({\n                    source: z\n                      .array(z.string())\n                      .describe('Authentication provider roles to be mapped from.'),\n                    target: z.string().describe('Toolpad Studio role to be mapped to.'),\n                  }),\n                )\n                .optional()\n                .describe('Role mapping definition for this authentication provider.'),\n            }),\n          )\n          .optional()\n          .describe('Authentication providers to use.'),\n        restrictedDomains: z\n          .array(z.string())\n          .optional()\n          .describe('Valid email patterns for the authenticated user.'),\n      })\n      .optional()\n      .describe('Authentication configuration for this application.'),\n    authorization: z\n      .object({\n        roles: z\n          .array(\n            z.union([\n              z.string(),\n              z.object({\n                name: z.string().describe('The name of the role.'),\n                description: z.string().optional().describe('A description of the role.'),\n              }),\n            ]),\n          )\n          .optional()\n          .describe('Available roles for this application. These can be assigned to users.'),\n      })\n      .optional()\n      .describe('Authorization configuration for this application.'),\n  }),\n);\n\nexport type Application = z.infer<typeof applicationSchema>;\n\nexport const pageSchema = toolpadObjectSchema(\n  'page',\n  z.object({\n    displayName: z.string().optional().describe('Page name to display in the UI.'),\n    id: z\n      .string()\n      .optional()\n      .describe('Serves as a canonical id of the page. Deprecated: use an alias instead.'),\n    alias: z.array(z.string()).optional().describe('Page name aliases.'),\n    title: z.string().optional().describe('Title for this page.'),\n    parameters: z\n      .array(nameStringValuePairSchema)\n      .optional()\n      .describe('Parameters for the page. These can be set inside of the url query string.'),\n    queries: z\n      .array(querySchema)\n      .optional()\n      .describe('Queries that are used by the page. These will load data when the page opens.'),\n    content: z\n      .array(elementSchema)\n      .optional()\n      .describe('The content of the page. This defines the UI.'),\n    authorization: z\n      .object({\n        allowAll: z.boolean().optional().describe('Allow all users to access this page.'),\n        allowedRoles: z\n          .array(z.string())\n          .optional()\n          .describe('Roles that are allowed to access this page.'),\n      })\n      .optional()\n      .describe('Authorization configuration for this page.'),\n    display: z\n      .union([\n        z\n          .literal('standalone')\n          .describe('Hide the Toolpad Studio chrome and just display the content of the page'),\n        z.literal('shell').describe('Show Toolpad Studio header and navigation.'),\n      ])\n      .optional()\n      .describe(\n        'Display mode of the page. This can also be set at runtime with the toolpad-display query parameter',\n      ),\n    maxWidth: z\n      .union([\n        z.literal('xs'),\n        z.literal('sm'),\n        z.literal('md'),\n        z.literal('lg'),\n        z.literal('xl'),\n        z.literal('none'),\n      ])\n      .optional()\n      .describe('Top level element of the page.'),\n  }),\n);\n\nconst simplePaletteColorOptionsSchema: z.ZodType<SimplePaletteColorOptions> = z.object({\n  main: z.string(),\n  light: z.string().optional(),\n  dark: z.string().optional(),\n  contrastText: z.string().optional(),\n});\n\nconst themeOptionsSchema: z.ZodType<ThemeOptions> = z\n  .object({\n    // TODO: expand to full MUI theme object\n    palette: z\n      .object({\n        mode: z.union([z.literal('light'), z.literal('dark')]).optional(),\n        primary: simplePaletteColorOptionsSchema.optional(),\n        secondary: simplePaletteColorOptionsSchema.optional(),\n      })\n      .passthrough()\n      .optional(),\n  })\n  .passthrough();\n\nexport type Page = z.infer<typeof pageSchema>;\n\nexport const themeSchema = toolpadObjectSchema(\n  'theme',\n  z.object({\n    options: themeOptionsSchema\n      .optional()\n      .describe(\"The ThemeOptions object that gets fed into MUI's createTheme function.\"),\n  }),\n);\n\nexport type Theme = z.infer<typeof themeSchema>;\n\nexport const META = {\n  schemas: {\n    Application: applicationSchema,\n    Page: pageSchema,\n    Theme: themeSchema,\n  },\n  definitions: {\n    JsExpressionBinding: jsExpressionBindingSchema,\n    EnvBinding: envBindingSchema,\n    JsExpressionAction: jsExpressionActionSchema,\n    NavigationAction: navigationActionSchema,\n    BindableProp: bindablePropSchema,\n    Element: elementSchema,\n    Template: templateSchema,\n    NameStringValuePair: nameStringValuePairSchema,\n    BindableNameStringValue: bindableNameStringValueSchema,\n    SimplePaletteColorOptions: simplePaletteColorOptionsSchema,\n  },\n};\n","import prettier from 'prettier';\nimport parserBabel from 'prettier/parser-babel';\n\nconst DEFAULT_OPTIONS = {\n  parser: 'babel-ts',\n  plugins: [parserBabel],\n};\n\n/**\n * get prettier config file\n */\nexport async function resolvePrettierConfig(filePath: string) {\n  const config = await prettier.resolveConfig(filePath);\n  return config;\n}\n\n/**\n * Formats a javascript source with `prettier`.\n */\nexport async function format(code: string, filePath: string): Promise<string> {\n  const readConfig = await resolvePrettierConfig(filePath);\n  return prettier.format(code, {\n    ...readConfig,\n    ...DEFAULT_OPTIONS,\n  });\n}\n\n/**\n * Formats a javascript expression with `prettier`.\n */\nexport async function formatExpression(\n  code: string,\n  config?: prettier.Options | null,\n): Promise<string> {\n  const formatted = await prettier.format(code, {\n    ...config,\n    ...DEFAULT_OPTIONS,\n    semi: false,\n  });\n\n  // There's no mode to format expressions in prettier. It will insert a semicolon in front\n  // in certain occasions. See https://github.com/prettier/prettier/issues/2841\n  return formatted.replace(/^;/, '');\n}\n\n/**\n * Formats a javascript expression with `prettier`, if it's valid.\n */\nexport async function tryFormatExpression(\n  code: string,\n  config?: prettier.Options,\n): Promise<string> {\n  try {\n    return await formatExpression(code, config);\n  } catch (err) {\n    return code;\n  }\n}\n","import * as path from 'path';\nimport * as chokidar from 'chokidar';\nimport * as dotenv from 'dotenv';\nimport { Emitter } from '@toolpad/utils/events';\nimport chalk from 'chalk';\nimport { truncate } from '@toolpad/utils/strings';\nimport { Awaitable } from '@toolpad/utils/types';\nimport { ProjectEvents } from '../types';\n\ninterface IToolpadProject {\n  options: { dev: boolean };\n  events: Emitter<ProjectEvents>;\n  getRoot(): string;\n}\n\n/**\n * Get file path for the env file.\n */\nfunction getEnvFilePath() {\n  return path.resolve(process.cwd(), '.env');\n}\n\n/**\n * Handles loading env files and watches for updates.\n */\nexport default class EnvManager {\n  private project: IToolpadProject;\n\n  private originalEnv: Record<string, string | undefined> = { ...process.env };\n\n  private values: Awaitable<Record<string, string>> = {};\n\n  private watcher: chokidar.FSWatcher | undefined;\n\n  constructor(project: IToolpadProject) {\n    this.project = project;\n  }\n\n  async start() {\n    this.loadEnvFile();\n    if (this.project.options.dev) {\n      this.initWatcher();\n    }\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async build() {\n    // Dummy method\n  }\n\n  async dispose() {\n    await this.watcher?.close();\n  }\n\n  private resetEnv() {\n    Object.keys(process.env).forEach((key) => {\n      delete process.env[key];\n    });\n    Object.assign(process.env, this.originalEnv);\n  }\n\n  private loadEnvFile() {\n    const envFilePath = getEnvFilePath();\n    this.resetEnv();\n    const { parsed = {} } = dotenv.config({ path: envFilePath, override: true });\n    this.values = parsed;\n    // eslint-disable-next-line no-console\n    console.log(\n      `${chalk.blue('info')}  - loaded env file \"${envFilePath}\" with keys ${truncate(\n        Object.keys(parsed).join(', '),\n        1000,\n      )}`,\n    );\n  }\n\n  private initWatcher() {\n    if (!this.project.options.dev) {\n      return;\n    }\n\n    this.watcher = chokidar.watch([getEnvFilePath()], {\n      usePolling: true,\n      ignoreInitial: true,\n    });\n\n    const handleChange = async () => {\n      this.loadEnvFile();\n\n      this.project.events.emit('envChanged', {});\n    };\n\n    this.watcher.on('add', handleChange);\n    this.watcher.on('unlink', handleChange);\n    this.watcher.on('change', handleChange);\n  }\n\n  async getDeclaredKeys(): Promise<string[]> {\n    return Object.keys(this.values);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  getEnv() {\n    return process.env;\n  }\n}\n","import * as path from 'path';\nimport * as fs from 'fs/promises';\nimport { Emitter } from '@toolpad/utils/events';\nimport * as esbuild from 'esbuild';\nimport { ensureSuffix, indent } from '@toolpad/utils/strings';\nimport * as chokidar from 'chokidar';\nimport chalk from 'chalk';\nimport { glob } from 'glob';\nimport { writeFileRecursive, fileExists, readJsonFile } from '@toolpad/utils/fs';\nimport Piscina from 'piscina';\nimport {\n  ExecFetchResult,\n  GetRecordsParams,\n  GetRecordsResult,\n  PaginationMode,\n  ToolpadDataProviderIntrospection,\n} from '@toolpad/studio-runtime';\nimport { errorFrom } from '@toolpad/utils/errors';\nimport * as url from 'node:url';\nimport type { GridRowId } from '@mui/x-data-grid';\nimport invariant from 'invariant';\nimport { Awaitable } from '@toolpad/utils/types';\nimport { ProjectEvents } from '../types';\nimport * as functionsRuntime from './functionsRuntime';\nimport type { ExtractTypesParams, IntrospectionResult } from './functionsTypesWorker';\nimport { format } from '../utils/prettier';\nimport { compilerOptions } from './functionsShared';\n\nexport interface CreateDataProviderOptions {\n  paginationMode: PaginationMode;\n}\n\nconst currentDirectory = url.fileURLToPath(new URL('.', String(import.meta.url)));\n\nasync function createDefaultFunction(filePath: string): Promise<string> {\n  const result = await format(\n    `\n    /**\n     * Toolpad Studio handlers file.\n     */\n\n    export default async function handler (message: string) {\n      return \\`Hello \\${message}\\`;\n    }\n  `,\n    filePath,\n  );\n  return result;\n}\n\nasync function createDefaultDataProvider(\n  filePath: string,\n  options: CreateDataProviderOptions,\n): Promise<string> {\n  const result = await format(\n    `\n    /**\n     * Toolpad data provider file.\n     * See: https://mui.com/toolpad/studio/concepts/data-providers/\n     */\n\n    import { createDataProvider } from '@toolpad/studio/server';\n\n    export default createDataProvider({\n      ${options.paginationMode === 'cursor' ? 'paginationMode: \"cursor\",' : ''}\n      async getRecords({ paginationModel: ${\n        options.paginationMode === 'cursor' ? '{ cursor, pageSize }' : '{ start, pageSize }'\n      } }) {\n        return {\n          records: [],\n          ${options.paginationMode === 'cursor' ? 'cursor: null,' : ''}\n        };\n      }\n    })\n  `,\n    filePath,\n  );\n  return result;\n}\n\nfunction formatCodeFrame(location: esbuild.Location): string {\n  const lineNumberCharacters = Math.ceil(Math.log10(location.line));\n  return [\n    `${location.file}:${location.line}:${location.column}:`,\n    `  ${location.line} │ ${location.lineText}`,\n    `  ${' '.repeat(lineNumberCharacters)} ╵ ${' '.repeat(\n      Math.max(location.lineText.length - 1, 0),\n    )}^`,\n  ].join('\\n');\n}\n\nfunction formatError(esbuildError: esbuild.Message): Error {\n  let messageText = esbuildError.text;\n  if (esbuildError.location) {\n    const formattedLocation = indent(formatCodeFrame(esbuildError.location), 2);\n    messageText = [messageText, formattedLocation].join('\\n');\n  }\n  return new Error(messageText);\n}\n\ninterface IToolpadProject {\n  options: { dev: boolean };\n  events: Emitter<ProjectEvents>;\n  getRoot(): string;\n  getOutputFolder(): string;\n}\n\nexport default class FunctionsManager {\n  private project: IToolpadProject;\n\n  private buildErrors: esbuild.Message[] = [];\n\n  private extractedTypes: Awaitable<IntrospectionResult> | undefined;\n\n  private extractTypesWorker: Piscina | undefined;\n\n  private buildCtx: esbuild.BuildContext | undefined;\n\n  constructor(project: IToolpadProject) {\n    this.project = project;\n  }\n\n  private getResourcesFolder(): string {\n    return path.join(this.project.getRoot(), './resources');\n  }\n\n  private getFunctionsFile(): string {\n    return path.join(this.getResourcesFolder(), './functions.ts');\n  }\n\n  async getFunctionFilePath(fileName: string): Promise<string> {\n    const resourcesFolder = this.getResourcesFolder();\n    return path.join(resourcesFolder, fileName);\n  }\n\n  private getFunctionResourcesPattern(): string {\n    return path.join(this.getResourcesFolder(), '*.ts');\n  }\n\n  private async migrateLegacy() {\n    const legacyQueriesFile = path.resolve(this.project.getRoot(), 'queries.ts');\n    if (await fileExists(legacyQueriesFile)) {\n      const functionsFile = this.getFunctionsFile();\n      await fs.mkdir(path.dirname(functionsFile), { recursive: true });\n      await fs.rename(legacyQueriesFile, functionsFile);\n    }\n  }\n\n  private async getFunctionFiles(): Promise<string[]> {\n    const paths = await glob(this.getFunctionResourcesPattern(), { windowsPathsNoEscape: true });\n    return paths.map((fullPath) => path.relative(this.project.getRoot(), fullPath));\n  }\n\n  private getBuildErrorsForFile(entryPoint: string) {\n    return this.buildErrors.filter((error) => error.location?.file === entryPoint);\n  }\n\n  private getFunctionsOutputFolder(): string {\n    return path.resolve(this.project.getOutputFolder(), 'functions');\n  }\n\n  private getIntrospectJsonPath(): string {\n    return path.resolve(this.getFunctionsOutputFolder(), 'introspect.json');\n  }\n\n  private async extractTypes() {\n    if (!this.extractTypesWorker) {\n      this.extractTypesWorker = new Piscina({\n        filename: path.resolve(currentDirectory, '../cli/functionsTypesWorker.mjs'),\n      });\n    }\n\n    const extractedTypes: Promise<IntrospectionResult> = this.extractTypesWorker\n      .run({ resourcesFolder: this.getResourcesFolder() } satisfies ExtractTypesParams, {})\n      .catch((error: unknown) => ({\n        error,\n        files: [],\n      }));\n    return extractedTypes;\n  }\n\n  private async createEsbuildContext() {\n    const root = this.project.getRoot();\n\n    const onFunctionBuildStart = async () => {\n      this.extractedTypes = undefined;\n    };\n\n    const onFunctionsBuildEnd = async (args: esbuild.BuildResult<esbuild.BuildOptions>) => {\n      // TODO: use for hot reloading\n      // eslint-disable-next-line no-console\n      console.log(\n        `${chalk.green('ready')} - built functions.ts: ${args.errors.length} error(s), ${\n          args.warnings.length\n        } warning(s)`,\n      );\n\n      this.buildErrors = args.errors;\n\n      this.project.events.emit('functionsChanged', {});\n    };\n\n    const toolpadStudioPlugin: esbuild.Plugin = {\n      name: 'toolpad-studio',\n      setup(build) {\n        build.onStart(onFunctionBuildStart);\n        build.onEnd(onFunctionsBuildEnd);\n      },\n    };\n\n    const entryPoints = await this.getFunctionFiles();\n    return esbuild.context({\n      absWorkingDir: root,\n      entryPoints,\n      plugins: [toolpadStudioPlugin],\n      write: true,\n      bundle: true,\n      metafile: true,\n      outdir: this.getFunctionsOutputFolder(),\n      outExtension: { '.js': '.mjs' },\n      platform: 'node',\n      format: 'esm',\n      packages: 'external',\n      target: 'es2022',\n      tsconfigRaw: JSON.stringify({ compilerOptions }),\n      loader: {\n        '.txt': 'text',\n        '.sql': 'text',\n      },\n    });\n  }\n\n  private async startWatchingFunctionFiles() {\n    // Make sure we pick up added/removed function files\n    const resourcesWatcher = chokidar.watch([this.getFunctionResourcesPattern()], {\n      ignoreInitial: true,\n    });\n\n    const reinitializeWatcher = async () => {\n      await this.buildCtx?.dispose();\n      this.buildCtx = await this.createEsbuildContext();\n      await this.buildCtx.watch();\n    };\n\n    reinitializeWatcher();\n    resourcesWatcher.on('add', reinitializeWatcher);\n    resourcesWatcher.on('unlink', reinitializeWatcher);\n  }\n\n  async start() {\n    if (this.project.options.dev) {\n      await this.migrateLegacy();\n      await this.startWatchingFunctionFiles();\n    }\n  }\n\n  async build() {\n    const ctx = await this.createEsbuildContext();\n    await ctx.rebuild();\n    await ctx.dispose();\n\n    const types = await this.extractTypes();\n    if (types.error) {\n      throw errorFrom(types.error);\n    }\n\n    await fs.mkdir(this.getFunctionsOutputFolder(), { recursive: true });\n    await fs.writeFile(this.getIntrospectJsonPath(), JSON.stringify(types, null, 2), 'utf-8');\n  }\n\n  private async disposeBuildcontext() {\n    this.buildCtx?.dispose();\n    this.buildCtx = undefined;\n  }\n\n  async dispose() {\n    await Promise.all([this.disposeBuildcontext(), this.extractTypesWorker?.destroy()]);\n  }\n\n  async getBuiltOutputFilePath(fileName: string): Promise<string> {\n    const resourcesFolder = this.getResourcesFolder();\n    const fullPath = path.resolve(resourcesFolder, fileName);\n    const entryPoint = path.relative(this.project.getRoot(), fullPath);\n\n    const buildErrors = this.getBuildErrorsForFile(entryPoint);\n\n    if (buildErrors.length > 0) {\n      throw formatError(buildErrors[0]);\n    }\n\n    const outputFilePath = path.resolve(\n      this.getFunctionsOutputFolder(),\n      `${path.basename(fileName, '.ts')}.mjs`,\n    );\n\n    return outputFilePath;\n  }\n\n  async exec(\n    fileName: string,\n    name: string,\n    parameters: Record<string, unknown>,\n  ): Promise<ExecFetchResult<unknown>> {\n    const extractedTypes = await this.introspect();\n\n    if (extractedTypes.error) {\n      throw errorFrom(extractedTypes.error);\n    }\n\n    const file = extractedTypes.files.find((fileEntry) => fileEntry.name === fileName);\n    const handler = file?.handlers.find((handlerEntry) => handlerEntry.name === name);\n\n    if (!handler) {\n      throw new Error(`No function found with the name \"${name}\"`);\n    }\n\n    const executeParams = handler.isCreateFunction\n      ? [{ parameters }]\n      : handler.parameters.map(([parameterName]) => parameters[parameterName]);\n\n    return this.execFunction(fileName, name, executeParams);\n  }\n\n  async execFunction(\n    fileName: string,\n    name: string,\n    parameters: unknown[],\n  ): Promise<ExecFetchResult<unknown>> {\n    const outputFilePath = await this.getBuiltOutputFilePath(fileName);\n\n    const data = await functionsRuntime.execute(outputFilePath, name, parameters);\n\n    return { data };\n  }\n\n  async introspect(): Promise<IntrospectionResult> {\n    if (!this.extractedTypes) {\n      if (this.project.options.dev) {\n        this.extractedTypes = this.extractTypes();\n      } else {\n        this.extractedTypes = readJsonFile(\n          this.getIntrospectJsonPath(),\n        ) as Promise<IntrospectionResult>;\n      }\n    }\n\n    return this.extractedTypes;\n  }\n\n  async createFunctionFile(name: string): Promise<void> {\n    const filePath = path.resolve(this.getResourcesFolder(), ensureSuffix(name, '.ts'));\n    const content = await createDefaultFunction(filePath);\n    if (await fileExists(filePath)) {\n      throw new Error(`\"${name}\" already exists`);\n    }\n    await writeFileRecursive(filePath, content, { encoding: 'utf-8' });\n    this.extractedTypes = undefined;\n  }\n\n  async createDataProviderFile(name: string, options: CreateDataProviderOptions): Promise<void> {\n    const filePath = path.resolve(this.getResourcesFolder(), ensureSuffix(name, '.ts'));\n    const content = await createDefaultDataProvider(filePath, options);\n    if (await fileExists(filePath)) {\n      throw new Error(`\"${name}\" already exists`);\n    }\n    await writeFileRecursive(filePath, content, { encoding: 'utf-8' });\n    this.extractedTypes = undefined;\n  }\n\n  async introspectDataProvider(\n    fileName: string,\n    exportName: string = 'default',\n  ): Promise<ToolpadDataProviderIntrospection> {\n    const fullPath = await this.getBuiltOutputFilePath(fileName);\n    const dataProvider = await functionsRuntime.loadDataProvider(fullPath, exportName);\n    return {\n      paginationMode: dataProvider.paginationMode,\n      hasDeleteRecord: !!dataProvider.deleteRecord,\n      hasUpdateRecord: !!dataProvider.updateRecord,\n      hasCreateRecord: !!dataProvider.createRecord,\n    };\n  }\n\n  async getDataProviderRecords<R, P extends PaginationMode>(\n    fileName: string,\n    exportName: string,\n    params: GetRecordsParams<R, P>,\n  ): Promise<GetRecordsResult<R, P>> {\n    const fullPath = await this.getBuiltOutputFilePath(fileName);\n    const dataProvider = await functionsRuntime.loadDataProvider(fullPath, exportName);\n    return dataProvider.getRecords(params);\n  }\n\n  async deleteDataProviderRecord(\n    fileName: string,\n    exportName: string,\n    id: GridRowId,\n  ): Promise<void> {\n    const fullPath = await this.getBuiltOutputFilePath(fileName);\n    const dataProvider = await functionsRuntime.loadDataProvider(fullPath, exportName);\n    invariant(dataProvider.deleteRecord, 'DataProvider does not support deleteRecord');\n    return dataProvider.deleteRecord(id);\n  }\n\n  async updateDataProviderRecord(\n    fileName: string,\n    exportName: string,\n    id: GridRowId,\n    values: Record<string, unknown>,\n  ): Promise<void> {\n    const fullPath = await this.getBuiltOutputFilePath(fileName);\n    const dataProvider = await functionsRuntime.loadDataProvider(fullPath, exportName);\n    invariant(dataProvider.updateRecord, 'DataProvider does not support updateRecord');\n    return dataProvider.updateRecord(id, values);\n  }\n\n  async createDataProviderRecord(\n    fileName: string,\n    exportName: string,\n    values: Record<string, unknown>,\n  ): Promise<void> {\n    const fullPath = await this.getBuiltOutputFilePath(fileName);\n    const dataProvider = await functionsRuntime.loadDataProvider(fullPath, exportName);\n    invariant(dataProvider.createRecord, 'DataProvider does not support createRecord');\n    return dataProvider.createRecord(values);\n  }\n}\n","import * as path from 'path';\nimport * as url from 'url';\nimport * as fs from 'fs/promises';\nimport { TOOLPAD_DATA_PROVIDER_MARKER, ToolpadDataProvider } from '@toolpad/studio-runtime/server';\nimport * as z from 'zod';\nimport { fromZodError } from 'zod-validation-error';\nimport * as crypto from 'crypto';\n\nasync function loadExports(filePath: string): Promise<Map<string, unknown>> {\n  // Need a valid file URL on Windows for the dynamic import()\n  const importFileUrl = url.pathToFileURL(path.resolve(filePath));\n  const content = await fs.readFile(importFileUrl, 'utf-8');\n  const hash = crypto.createHash('md5').update(content).digest('hex');\n  importFileUrl.searchParams.set('hash', hash);\n  // `webpackIgnore: true` is used to instruct webpack in Next.js to use the native import() function\n  // instead of trying to bundle the dynamic import() call\n  const exports = await import(/* webpackIgnore: true */ importFileUrl.href);\n  return new Map(Object.entries(exports));\n}\n\nconst dataProviderSchema: z.ZodType<ToolpadDataProvider<any, any>> = z.object({\n  paginationMode: z.enum(['index', 'cursor']).optional().default('index'),\n  getRecords: z.function(z.tuple([z.any()]), z.any()),\n  deleteRecord: z.function(z.tuple([z.any()]), z.any()).optional(),\n  updateRecord: z.function(z.tuple([z.any(), z.any()]), z.any()).optional(),\n  createRecord: z.function(z.tuple([z.any()]), z.any()).optional(),\n  [TOOLPAD_DATA_PROVIDER_MARKER]: z.literal(true),\n});\n\nexport async function loadDataProvider(\n  filePath: string,\n  name: string,\n): Promise<ToolpadDataProvider<any, any>> {\n  const exports = await loadExports(filePath);\n  const dataProviderExport = exports.get(name);\n\n  if (!dataProviderExport || typeof dataProviderExport !== 'object') {\n    throw new Error(`DataProvider \"${name}\" not found`);\n  }\n\n  const parsed = dataProviderSchema.safeParse(dataProviderExport);\n\n  if (parsed.success) {\n    return parsed.data;\n  }\n\n  throw fromZodError(parsed.error);\n}\n\nexport async function execute(filePath: string, name: string, parameters: unknown[]): Promise<any> {\n  const exports = await loadExports(filePath);\n\n  const fn = exports.get(name);\n  if (typeof fn !== 'function') {\n    throw new Error(`Function \"${name}\" not found`);\n  }\n\n  const result = await fn(...parameters);\n\n  return result;\n}\n","import ts from 'typescript';\n\nexport const compilerOptions: ts.CompilerOptions = {\n  noEmit: true,\n  target: ts.ScriptTarget.ESNext,\n  lib: ['lib.esnext.d.ts'],\n  types: ['node'],\n  // NOTE: strictNullChecks is essential for the type extraction to work properly. When we decide\n  // to support user-defined tsconfig.json, we must make sure this option is enabled.\n  strictNullChecks: true,\n  module: ts.ModuleKind.CommonJS,\n  moduleResolution: ts.ModuleResolutionKind.Bundler,\n  esModuleInterop: true,\n  allowSyntheticDefaultImports: true,\n};\n","import * as path from 'path';\nimport latestVersion from 'latest-version';\nimport * as semver from 'semver';\nimport { fileExists } from '@toolpad/utils/fs';\nimport pkg from '../../package.json';\n\nexport type PackageManager = 'npm' | 'yarn' | 'pnpm';\n\nasync function detectPackageManager(root: string) {\n  const [hasYarnLock, hasPackageLock, hasPnpmLock] = await Promise.all([\n    fileExists(path.resolve(root, './yarn.lock')),\n    fileExists(path.resolve(root, './package-lock.lock')),\n    fileExists(path.resolve(root, './pnpm-lock.lock')),\n  ]);\n\n  if (hasYarnLock) {\n    return 'yarn';\n  }\n\n  if (hasPnpmLock) {\n    return 'pnpm';\n  }\n\n  if (hasPackageLock) {\n    return 'npm';\n  }\n\n  return null;\n}\n\nexport interface VersionInfo {\n  current: string;\n  latest: string;\n  updateAvailable: boolean;\n  packageManager: PackageManager | null;\n}\n\nexport async function checkVersion(root: string): Promise<VersionInfo> {\n  const pkgName = '@toolpad/studio';\n  const [latest, packageManager] = await Promise.all([\n    latestVersion(pkgName),\n    detectPackageManager(root),\n  ]);\n  const current = pkg.version;\n  const updateAvailable = semver.compare(latest, current) > 0;\n  return { current, latest, updateAvailable, packageManager };\n}\n","{\n  \"name\": \"@toolpad/studio\",\n  \"version\": \"0.8.1\",\n  \"license\": \"MIT\",\n  \"bin\": {\n    \"toolpad-studio\": \"./cli.mjs\"\n  },\n  \"scripts\": {\n    \"build\": \"concurrently \\\"pnpm:build:*\\\"\",\n    \"dev\": \"concurrently \\\"pnpm:dev:*\\\"\",\n    \"cli\": \"./cli.mjs\",\n    \"lint\": \"prettier --check .\",\n    \"fix\": \"prettier --write .\",\n    \"build:cli\": \"tsup\",\n    \"dev:cli\": \"tsup --watch\",\n    \"check-types\": \"tsup && tsc --noEmit\",\n    \"test\": \"vitest run\"\n  },\n  \"keywords\": [\n    \"react\",\n    \"mui\",\n    \"toolpad\",\n    \"internal tools\",\n    \"crud\",\n    \"low code\",\n    \"admin\",\n    \"dashboard\"\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/mui/toolpad.git\",\n    \"directory\": \"packages/toolpad-studio\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/mui/toolpad/issues\"\n  },\n  \"homepage\": \"https://mui.com/toolpad/\",\n  \"files\": [\n    \"public\",\n    \"scripts\",\n    \"dist\",\n    \"cli.mjs\",\n    \"browser\",\n    \"server\",\n    \"runtime\"\n  ],\n  \"exports\": {\n    \"./package.json\": \"./package.json\",\n    \".\": {\n      \"types\": \"./dist/exports/index.d.ts\",\n      \"import\": \"./dist/exports/index.mjs\"\n    },\n    \"./*\": {\n      \"types\": \"./dist/exports/*.d.ts\",\n      \"import\": \"./dist/exports/*.mjs\"\n    }\n  },\n  \"dependencies\": {\n    \"@auth/core\": \"0.37.0\",\n    \"@emotion/cache\": \"11.13.1\",\n    \"@emotion/react\": \"11.13.3\",\n    \"@emotion/server\": \"11.11.0\",\n    \"@emotion/styled\": \"11.13.0\",\n    \"@googleapis/drive\": \"8.14.0\",\n    \"@googleapis/sheets\": \"9.3.1\",\n    \"@mui/icons-material\": \"6.1.4\",\n    \"@mui/lab\": \"6.0.0-beta.12\",\n    \"@mui/material\": \"6.1.4\",\n    \"@mui/system\": \"6.1.4\",\n    \"@mui/types\": \"7.2.18\",\n    \"@mui/utils\": \"6.1.4\",\n    \"@mui/x-charts\": \"7.21.0\",\n    \"@mui/x-data-grid\": \"7.21.0\",\n    \"@mui/x-data-grid-premium\": \"7.21.0\",\n    \"@mui/x-date-pickers\": \"7.21.0\",\n    \"@mui/x-date-pickers-pro\": \"7.21.0\",\n    \"@mui/x-tree-view\": \"7.21.0\",\n    \"@tanstack/react-query\": \"5.59.13\",\n    \"@tanstack/react-query-devtools\": \"5.59.13\",\n    \"@toolpad/core\": \"workspace:*\",\n    \"@toolpad/studio-components\": \"workspace:*\",\n    \"@toolpad/studio-runtime\": \"workspace:*\",\n    \"@toolpad/utils\": \"workspace:*\",\n    \"@types/cors\": \"2.8.17\",\n    \"@types/json-schema\": \"7.0.15\",\n    \"@types/node\": \"^20.16.11\",\n    \"@types/react-dev-utils\": \"9.0.15\",\n    \"@vitejs/plugin-react\": \"4.3.2\",\n    \"@webcontainer/env\": \"1.1.1\",\n    \"abort-controller\": \"3.0.0\",\n    \"basic-auth\": \"2.0.1\",\n    \"chalk\": \"5.3.0\",\n    \"chokidar\": \"3.6.0\",\n    \"clsx\": \"2.1.1\",\n    \"compression\": \"^1.7.4\",\n    \"concurrently\": \"9.0.1\",\n    \"cors\": \"2.8.5\",\n    \"csstype\": \"3.1.3\",\n    \"dayjs\": \"1.11.13\",\n    \"dotenv\": \"16.4.5\",\n    \"esbuild\": \"0.24.0\",\n    \"execa\": \"9.4.0\",\n    \"express\": \"4.21.1\",\n    \"find-up\": \"7.0.0\",\n    \"fractional-indexing\": \"3.2.0\",\n    \"get-port\": \"7.1.0\",\n    \"glob\": \"10.4.5\",\n    \"google-auth-library\": \"9.14.2\",\n    \"http-proxy-middleware\": \"3.0.3\",\n    \"invariant\": \"2.2.4\",\n    \"json-to-ts\": \"2.1.0\",\n    \"json5\": \"2.2.3\",\n    \"latest-version\": \"9.0.0\",\n    \"lodash-es\": \"4.17.21\",\n    \"markdown-to-jsx\": \"7.5.0\",\n    \"mime\": \"4.0.4\",\n    \"monaco-editor\": \"0.52.0\",\n    \"mysql2\": \"3.11.3\",\n    \"nanoid\": \"5.0.7\",\n    \"node-fetch\": \"2.7.0\",\n    \"node-fetch-har\": \"1.0.1\",\n    \"open-editor\": \"5.0.0\",\n    \"path-to-regexp\": \"6.3.0\",\n    \"perf-cascade\": \"3.0.3\",\n    \"pg\": \"8.13.0\",\n    \"piscina\": \"4.7.0\",\n    \"prettier\": \"3.3.3\",\n    \"pretty-bytes\": \"6.1.1\",\n    \"react\": \"18.3.1\",\n    \"react-dev-utils\": \"12.0.1\",\n    \"react-dom\": \"18.3.1\",\n    \"react-error-boundary\": \"4.0.13\",\n    \"react-hook-form\": \"7.53.0\",\n    \"react-inspector\": \"6.0.2\",\n    \"react-is\": \"18.3.1\",\n    \"react-resizable-panels\": \"2.1.4\",\n    \"react-router-dom\": \"6.26.2\",\n    \"semver\": \"7.6.3\",\n    \"serialize-javascript\": \"6.0.2\",\n    \"superjson\": \"2.0.0\",\n    \"typescript\": \"5.5.4\",\n    \"vite\": \"5.4.8\",\n    \"vm-browserify\": \"1.1.2\",\n    \"whatwg-url\": \"14.0.0\",\n    \"ws\": \"8.18.0\",\n    \"yaml\": \"2.5.1\",\n    \"yaml-diff-patch\": \"2.0.0\",\n    \"yargs\": \"17.7.2\",\n    \"zod\": \"3.23.8\",\n    \"zod-validation-error\": \"3.4.0\"\n  },\n  \"devDependencies\": {\n    \"@types/babel__code-frame\": \"7.0.6\",\n    \"@types/compression\": \"^1.7.5\",\n    \"@types/express\": \"5.0.0\",\n    \"@types/express-serve-static-core\": \"5.0.0\",\n    \"@types/formidable\": \"3.4.5\",\n    \"@types/glob\": \"8.1.0\",\n    \"@types/har-format\": \"1.2.16\",\n    \"@types/invariant\": \"2.2.37\",\n    \"@types/lodash-es\": \"4.17.12\",\n    \"@types/node-fetch\": \"2.6.11\",\n    \"@types/pg\": \"8.11.10\",\n    \"@types/react\": \"18.3.11\",\n    \"@types/react-dom\": \"18.3.1\",\n    \"@types/react-is\": \"18.3.0\",\n    \"@types/semver\": \"7.5.8\",\n    \"@types/serialize-javascript\": \"5.0.4\",\n    \"@types/whatwg-url\": \"11.0.5\",\n    \"@types/ws\": \"8.5.12\",\n    \"@types/yargs\": \"17.0.33\",\n    \"ajv\": \"8.17.1\",\n    \"eslint\": \"8.57.1\",\n    \"eslint-config-prettier\": \"9.1.0\",\n    \"eslint-plugin-import\": \"2.31.0\",\n    \"formidable\": \"3.5.1\",\n    \"react-transition-group\": \"4.4.5\",\n    \"webpack\": \"5.95.0\"\n  },\n  \"typings\": \"./index.d.ts\",\n  \"publishConfig\": {\n    \"access\": \"public\"\n  },\n  \"engines\": {\n    \"node\": \">=18\"\n  }\n}\n","import { NodeId, ExecFetchResult } from '@toolpad/studio-runtime';\nimport { withContext, createServerContext } from '@toolpad/studio-runtime/serverRuntime';\nimport { createServerJsRuntime } from '@toolpad/studio-runtime/jsServerRuntime';\nimport express, { Router } from 'express';\nimport cors from 'cors';\nimport invariant from 'invariant';\nimport { errorFrom, serializeError, SerializedError } from '@toolpad/utils/errors';\nimport * as appDom from '@toolpad/studio-runtime/appDom';\nimport type { Methods, ServerDataSource } from '../types';\nimport serverDataSources from '../toolpadDataSources/server';\nimport applyTransform from '../toolpadDataSources/applyTransform';\nimport { asyncHandler } from '../utils/express';\nimport type FunctionsManager from './FunctionsManager';\nimport type EnvManager from './EnvManager';\n\nfunction withSerializedError<T extends { error?: unknown }>(\n  withError: T,\n): Omit<T, 'error'> & { error?: SerializedError } {\n  const { error, ...withoutError } = withError;\n  return withError.error\n    ? { ...withoutError, error: serializeError(errorFrom(error)) }\n    : withoutError;\n}\n\ninterface IToolpadProject {\n  options: { dev: boolean };\n  getRoot(): string;\n  loadDom(): Promise<appDom.AppDom>;\n  saveDom(dom: appDom.AppDom): Promise<void>;\n  functionsManager: FunctionsManager;\n  envManager: EnvManager;\n}\n\n/**\n * Handles loading env files and watches for updates.\n */\nexport default class DataManager {\n  private project: IToolpadProject;\n\n  private dataSources: Map<string, ServerDataSource<any, any, any> | undefined> | undefined;\n\n  constructor(project: IToolpadProject) {\n    this.project = project;\n  }\n\n  getDataSources(): Map<string, ServerDataSource<any, any, any> | undefined> {\n    if (!this.dataSources) {\n      this.dataSources = new Map(\n        Object.entries(serverDataSources).map(([key, value]) => [\n          key,\n          typeof value === 'function' ? value(this.project) : value,\n        ]),\n      );\n    }\n    return this.dataSources;\n  }\n\n  async getConnectionParams<P = unknown>(connectionId: string | null): Promise<P | null> {\n    const dom = await this.project.loadDom();\n    const node = appDom.getNode(\n      dom,\n      connectionId as NodeId,\n      'connection',\n    ) as appDom.ConnectionNode<P>;\n    return node.attributes.params.$$secret;\n  }\n\n  async setConnectionParams<P>(connectionId: NodeId, params: P): Promise<void> {\n    let dom = await this.project.loadDom();\n    const existing = appDom.getNode(dom, connectionId, 'connection');\n\n    dom = appDom.setNodeNamespacedProp(\n      dom,\n      existing,\n      'attributes',\n      'params',\n      appDom.createSecret(params),\n    );\n\n    await this.project.saveDom(dom);\n  }\n\n  async execDataNodeQuery<P, Q>(\n    dataNode: appDom.QueryNode<Q>,\n    params: Q,\n  ): Promise<ExecFetchResult<any>> {\n    const dataSources = this.getDataSources();\n    const dataSource: ServerDataSource<P, Q, any> | undefined = dataNode.attributes.dataSource\n      ? dataSources.get(dataNode.attributes.dataSource)\n      : undefined;\n    if (!dataSource) {\n      throw new Error(\n        `Unknown datasource \"${dataNode.attributes.dataSource}\" for query \"${dataNode.id}\"`,\n      );\n    }\n\n    let result = await dataSource.exec(null, dataNode.attributes.query, params);\n\n    if (appDom.isQuery(dataNode)) {\n      const transformEnabled = dataNode.attributes.transformEnabled;\n      const transform = dataNode.attributes.transform;\n      if (transformEnabled && transform) {\n        const jsServerRuntime = await createServerJsRuntime(process.env);\n        result = {\n          data: await applyTransform(jsServerRuntime, transform, result.data),\n        };\n      }\n    }\n\n    return result;\n  }\n\n  async execQuery(pageName: string, queryName: string, params: any): Promise<ExecFetchResult<any>> {\n    const dom = await this.project.loadDom();\n\n    const page = appDom.getPageByName(dom, pageName);\n\n    if (!page) {\n      throw new Error(`Unknown page \"${pageName}\"`);\n    }\n\n    const dataNode = appDom.getQueryByName(dom, page, queryName);\n\n    if (!dataNode) {\n      throw new Error(`Unknown query \"${queryName}\"`);\n    }\n\n    if (!appDom.isQuery(dataNode)) {\n      throw new Error(`Invalid node type for data request`);\n    }\n\n    try {\n      const result = await this.execDataNodeQuery(dataNode, params);\n      return withSerializedError(result);\n    } catch (error) {\n      return withSerializedError({ error });\n    }\n  }\n\n  async dataSourceFetchPrivate<P, Q>(\n    dataSourceId: string,\n    connectionId: NodeId | null,\n    query: Q,\n  ): Promise<any> {\n    const dataSources = this.getDataSources();\n    const dataSource: ServerDataSource<P, Q, any> | undefined = dataSources.get(dataSourceId);\n\n    if (!dataSource) {\n      throw new Error(`Unknown dataSource \"${dataSourceId}\"`);\n    }\n\n    if (!dataSource.execPrivate) {\n      throw new Error(`No execPrivate available on datasource \"${dataSourceId}\"`);\n    }\n\n    return dataSource.execPrivate(null, query);\n  }\n\n  async dataSourceExecPrivate<P, Q, PQS extends Methods>(\n    dataSourceId: string,\n    method: keyof PQS,\n    args: any[],\n  ): Promise<any> {\n    const dataSources = this.getDataSources();\n    const dataSource = dataSources.get(dataSourceId) as\n      | ServerDataSource<P, Q, any, PQS>\n      | undefined;\n\n    if (!dataSource) {\n      throw new Error(`Unknown dataSource \"${dataSourceId}\"`);\n    }\n\n    if (!dataSource.api) {\n      throw new Error(`No api available on datasource \"${dataSourceId}\"`);\n    }\n\n    return dataSource.api[method](...args);\n  }\n\n  createDataHandler(): Router {\n    const router = express.Router();\n\n    router.use(\n      cors({\n        methods: ['GET', 'HEAD', 'PUT', 'PATCH', 'POST', 'DELETE'],\n        // TODO: make this configurable\n        origin: '*',\n      }),\n    );\n\n    router.post(\n      '/:pageName/:queryName',\n      express.json(),\n      asyncHandler(async (req, res) => {\n        const { pageName, queryName } = req.params;\n\n        invariant(typeof pageName === 'string', 'pageName url param required');\n        invariant(typeof queryName === 'string', 'queryName url variable required');\n\n        const ctx = await createServerContext(req, res);\n        const result = await withContext(ctx, async () => {\n          return this.execQuery(pageName, queryName, req.body);\n        });\n        res.json(result);\n      }),\n    );\n\n    return router;\n  }\n\n  createDataSourcesHandler(): Router {\n    const dataSources = this.getDataSources();\n    const router = express.Router();\n\n    const handlerMap = new Map<String, Function | null | undefined>();\n    Object.keys(serverDataSources).forEach((dataSourceId) => {\n      const handler = dataSources.get(dataSourceId)?.createHandler?.();\n      if (handler) {\n        invariant(\n          typeof handler === 'function',\n          `Received a \"${typeof handler}\" instead of a \"function\" for the \"${dataSourceId}\" handler`,\n        );\n        handlerMap.set(dataSourceId, handler);\n      }\n    });\n\n    router.get(\n      '/:dataSource/*',\n      asyncHandler(async (req, res) => {\n        const dataSource = req.params.dataSource;\n\n        if (!dataSource) {\n          throw new Error(`Missing path parameter \"dataSource\"`);\n        }\n\n        const handler = handlerMap.get(dataSource);\n\n        if (typeof handler === 'function') {\n          return handler(this, req, res);\n        }\n\n        return res.status(404).json({ message: 'No handler found' });\n      }),\n    );\n\n    return router;\n  }\n}\n","import pg from 'pg';\nimport { errorFrom } from '@toolpad/utils/errors';\nimport { Maybe } from '@toolpad/utils/types';\nimport { SqlConnectionParams, SqlQuery, SqlResult } from '../sql/types';\nimport { createSqlServerDatasource } from '../sql/server';\n\nconst { Client } = pg;\n\n/**\n * Substitute named parameters ($varName) in a postgres query with their positional parameter ($1)\n */\nfunction parseQuery(sql: string, params: [string, any][]): pg.QueryConfig {\n  const substitutions = new Map(params.map(([name], i) => [name.toLowerCase(), i + 1]));\n  const sqlWithNamedVars = sql.replaceAll(/\\$([a-zA-Z][a-zA-Z0-9]*)/g, (match, varName) => {\n    const index = substitutions.get(varName.toLowerCase());\n    if (typeof index === 'number') {\n      return `$${index}`;\n    }\n    return match;\n  });\n\n  return {\n    text: sqlWithNamedVars,\n    values: params.map(([, value]) => value),\n  };\n}\n/**\n * Augment variables ($1, $2,...) in an error message with their name \"$varName($1)\"\n */\nfunction parseErrorMessage(msg: string, params: [string, any][]): string {\n  const substitutions = new Map(params.map(([name], i) => [i + 1, name]));\n  const msgWithNamedVars = msg.replaceAll(/\\$(\\d+)/g, (match, index) => {\n    const varName = substitutions.get(Number(index));\n    if (typeof varName === 'string') {\n      return `$${varName}(${match})`;\n    }\n    return match;\n  });\n\n  return msgWithNamedVars;\n}\n\nasync function execSql(\n  connection: Maybe<SqlConnectionParams>,\n  postgresQuery: SqlQuery,\n  params: Record<string, string>,\n): Promise<SqlResult> {\n  if (!connection?.password) {\n    // pg client doesn't support passwordless authentication atm\n    // See https://github.com/brianc/node-postgres/issues/1927\n    throw new Error(`Password required`);\n  }\n\n  const client = new Client({ ...connection });\n  const paramEntries = Object.entries(params);\n  try {\n    await client.connect();\n\n    const pgQuery = parseQuery(postgresQuery.sql, paramEntries);\n\n    const res = await client.query(pgQuery);\n\n    return {\n      data: res.rows,\n      info:\n        res.command !== 'SELECT'\n          ? `OK ${res.command}, ${res.rowCount} ${res.rowCount === 1 ? 'row' : 'rows'} affected`\n          : undefined,\n    };\n  } catch (rawError) {\n    const error = errorFrom(rawError);\n    error.message = parseErrorMessage(error.message, paramEntries);\n    throw error;\n  } finally {\n    await client.end();\n  }\n}\n\nconst testConnection = async (connection: Maybe<SqlConnectionParams>) => {\n  const client = new Client({ ...connection });\n  await client.connect();\n  await client.query('SELECT * FROM version();');\n};\n\nexport default createSqlServerDatasource<SqlConnectionParams, SqlQuery>({\n  execSql,\n  testConnection,\n});\n","import { serializeError, errorFrom } from '@toolpad/utils/errors';\nimport { ServerDataSource } from '../../types';\nimport { SqlServerProps, SqlPrivateQuery, SqlConnectionStatus } from './types';\n\nexport function createSqlServerDatasource<P, Q>({\n  execSql,\n  testConnection,\n}: SqlServerProps<P, Q>): ServerDataSource<P, Q, SqlPrivateQuery<P, Q>> {\n  return {\n    exec: async (connection, query, params) => {\n      const { data, error } = await execSql(connection, query, params);\n      return { data, error };\n    },\n    execPrivate: async (connection, query) => {\n      switch (query.kind) {\n        case 'debugExec':\n          return execSql(connection, query.query, query.params);\n        case 'connectionStatus': {\n          let connectionStatus: SqlConnectionStatus;\n          try {\n            await testConnection(query.params);\n            connectionStatus = { status: 'success' };\n            return { data: connectionStatus };\n          } catch (rawError) {\n            const serializedError = serializeError(errorFrom(rawError));\n            connectionStatus = {\n              status: 'error',\n              error: serializedError.message,\n            };\n            return { data: connectionStatus, error: serializedError };\n          }\n        }\n        default:\n          throw new Error(`Unknown query \"${(query as SqlPrivateQuery<P, Q>).kind}\"`);\n      }\n    },\n    api: {},\n  };\n}\n","import { createConnection, OkPacket, ResultSetHeader } from 'mysql2/promise';\nimport { errorFrom } from '@toolpad/utils/errors';\nimport { Maybe } from '@toolpad/utils/types';\nimport { SqlConnectionParams, SqlQuery, SqlResult } from '../sql/types';\nimport { createSqlServerDatasource } from '../sql/server';\n\n/**\n * Substitute all variables including named paramters ($varName) in a MySQL query with the placeholder '?'\n * and return an array containing the values to replace the placeholders with\n */\n\nfunction prepareQuery(sql: string, params: Record<string, string>) {\n  const substitutions: any[] = [];\n  const sqlWithVarsReplaced = sql.replaceAll(\n    // eslint-disable-next-line no-useless-escape\n    /(?<==|<|<=|>|>=|<>)[ ]*(([\\$\\w\\d]*\\b)|([']+[\\w ]+['][ ]*))|(;)/g,\n    (match) => {\n      const trimmedMatch = match.trim().replaceAll(/[']+/g, '');\n      if (trimmedMatch[0] === '$') {\n        const varName = trimmedMatch.slice(1);\n        if (typeof params[varName] !== 'undefined') {\n          substitutions.push(params[varName]);\n        }\n        return '?';\n      }\n      if (trimmedMatch === ';') {\n        return '';\n      }\n      substitutions.push(trimmedMatch);\n      return '?';\n    },\n  );\n  return {\n    sql: sqlWithVarsReplaced,\n    substitutions,\n  };\n}\n\nasync function execSql(\n  connection: Maybe<SqlConnectionParams>,\n  query: SqlQuery,\n  params: Record<string, string>,\n): Promise<SqlResult> {\n  const mysqlConnection = await createConnection({ ...connection });\n\n  try {\n    const { sql, substitutions } = prepareQuery(query.sql, params);\n\n    const [result] = await mysqlConnection.execute(sql, substitutions);\n\n    let rows: any[] = [];\n    let info: string | undefined;\n\n    if (Array.isArray(result)) {\n      rows = result;\n    } else {\n      info = (result as ResultSetHeader).info || (result as OkPacket).message;\n    }\n\n    return {\n      data: rows,\n      info,\n    };\n  } catch (rawError) {\n    const error = errorFrom(rawError);\n    throw error;\n  } finally {\n    await mysqlConnection.end();\n  }\n}\n\nasync function testConnection(connection: Maybe<SqlConnectionParams>): Promise<void> {\n  const mysqlConnection = await createConnection({ ...connection });\n  mysqlConnection.execute('SELECT 1');\n}\n\nexport default createSqlServerDatasource<SqlConnectionParams, SqlQuery>({\n  execSql,\n  testConnection,\n});\n","import {\n  ExecFetchResult,\n  BindableAttrEntries,\n  BindableAttrValue,\n  BindableAttrValues,\n  JsRuntime,\n} from '@toolpad/studio-runtime';\nimport fetch, { RequestInit, Response, Headers } from 'node-fetch';\nimport { createServerJsRuntime } from '@toolpad/studio-runtime/jsServerRuntime';\nimport { SerializedError, errorFrom, serializeError } from '@toolpad/utils/errors';\nimport { evaluateBindable } from '@toolpad/studio-runtime/jsRuntime';\nimport { removePrefix } from '@toolpad/utils/strings';\nimport { Maybe } from '@toolpad/utils/types';\nimport { withHarInstrumentation, createHarLog } from '../../server/har';\nimport { ServerDataSource } from '../../types';\nimport {\n  FetchPrivateQuery,\n  Body,\n  FetchQuery,\n  FetchResult,\n  RawBody,\n  RestConnectionParams,\n  UrlEncodedBody,\n  IntrospectionResult,\n} from './types';\nimport applyTransform from '../applyTransform';\nimport { HTTP_NO_BODY, getAuthenticationHeaders, parseBaseUrl } from './shared';\nimport type { IToolpadProject } from '../server';\n\nfunction resolveBindable<T>(\n  jsRuntime: JsRuntime,\n  bindable: BindableAttrValue<T>,\n  scope: Record<string, unknown>,\n): T {\n  const { value, error } = evaluateBindable(jsRuntime, bindable, scope);\n  if (error) {\n    throw error;\n  }\n  return value as T;\n}\n\nfunction resolveBindableEntries(\n  jsRuntime: JsRuntime,\n  entries: BindableAttrEntries,\n  scope: Record<string, unknown>,\n): [string, any][] {\n  return entries.map(([key, value]) => [key, resolveBindable(jsRuntime, value, scope)]);\n}\n\nfunction resolveBindables<P>(\n  jsRuntime: JsRuntime,\n  obj: BindableAttrValues<P>,\n  scope: Record<string, unknown>,\n): P {\n  return Object.fromEntries(\n    resolveBindableEntries(jsRuntime, Object.entries(obj) as BindableAttrEntries, scope),\n  ) as P;\n}\n\nfunction parseQueryUrl(queryUrl: string, baseUrl: Maybe<string>): URL {\n  if (baseUrl) {\n    const parsedBase = parseBaseUrl(baseUrl);\n    return new URL(parsedBase.href + removePrefix(queryUrl, '/'));\n  }\n\n  return new URL(queryUrl);\n}\n\ninterface ResolvedRawBody {\n  kind: 'raw';\n  contentType: string;\n  content: string;\n}\n\nfunction resolveRawBody(\n  jsRuntime: JsRuntime,\n  body: RawBody,\n  scope: Record<string, unknown>,\n): ResolvedRawBody {\n  const { content, contentType } = resolveBindables(\n    jsRuntime,\n    {\n      contentType: body.contentType,\n      content: body.content,\n    },\n    scope,\n  );\n  return {\n    kind: 'raw',\n    contentType,\n    content: String(content),\n  };\n}\n\ninterface ResolveUrlEncodedBodyBody {\n  kind: 'urlEncoded';\n  content: [string, string][];\n}\n\nfunction resolveUrlEncodedBody(\n  jsRuntime: JsRuntime,\n  body: UrlEncodedBody,\n  scope: Record<string, unknown>,\n): ResolveUrlEncodedBodyBody {\n  return {\n    kind: 'urlEncoded',\n    content: resolveBindableEntries(jsRuntime, body.content, scope),\n  };\n}\n\nfunction resolveBody(jsRuntime: JsRuntime, body: Body, scope: Record<string, unknown>) {\n  switch (body.kind) {\n    case 'raw':\n      return resolveRawBody(jsRuntime, body, scope);\n    case 'urlEncoded':\n      return resolveUrlEncodedBody(jsRuntime, body, scope);\n    default:\n      throw new Error(`Missing case for \"${(body as Body).kind}\"`);\n  }\n}\n\nasync function readData(res: Response, fetchQuery: FetchQuery): Promise<any> {\n  if (!fetchQuery.response || fetchQuery.response?.kind === 'json') {\n    return res.json();\n  }\n  if (fetchQuery.response?.kind === 'raw') {\n    return res.text();\n  }\n  throw new Error(`Unsupported response type \"${fetchQuery.response.kind}\"`);\n}\n\nasync function execBase(\n  project: IToolpadProject,\n  connection: Maybe<RestConnectionParams>,\n  fetchQuery: FetchQuery,\n  params: Record<string, string | BindableAttrValue<any>>,\n): Promise<FetchResult> {\n  const har = createHarLog();\n  const instrumentedFetch = withHarInstrumentation(fetch, { har });\n  const jsRuntime = createServerJsRuntime(process.env);\n  const resolvedParams = resolveBindableEntries(jsRuntime, Object.entries(params), {});\n\n  const queryScope = {\n    // @TODO: remove deprecated query after v1\n    query: params,\n    parameters: Object.fromEntries(resolvedParams),\n  };\n\n  const urlvalue = fetchQuery.url ?? '';\n  const resolvedUrl = resolveBindable(jsRuntime, urlvalue, queryScope);\n  const resolvedSearchParams = resolveBindableEntries(\n    jsRuntime,\n    fetchQuery.searchParams || [],\n    queryScope,\n  );\n  const resolvedHeaders = resolveBindableEntries(jsRuntime, fetchQuery.headers || [], queryScope);\n\n  const queryUrl = parseQueryUrl(resolvedUrl, connection?.baseUrl);\n  resolvedSearchParams.forEach(([key, value]) => queryUrl.searchParams.append(key, value));\n\n  const headers = new Headers([\n    ...(connection ? getAuthenticationHeaders(connection.authentication) : []),\n    ...(connection?.headers || []),\n  ]);\n  resolvedHeaders.forEach(([key, value]) => headers.append(key, value));\n\n  const method = fetchQuery.method || 'GET';\n\n  const requestInit: RequestInit = { method, headers };\n\n  if (!HTTP_NO_BODY.has(method) && fetchQuery.body) {\n    const resolvedBody = resolveBody(jsRuntime, fetchQuery.body, queryScope);\n\n    switch (resolvedBody.kind) {\n      case 'raw': {\n        headers.set('content-type', resolvedBody.contentType);\n        requestInit.body = resolvedBody.content;\n        break;\n      }\n      case 'urlEncoded': {\n        headers.set('content-type', 'application/x-www-form-urlencoded');\n        requestInit.body = new URLSearchParams(resolvedBody.content).toString();\n        break;\n      }\n      default:\n        throw new Error(`Missing case for \"${(resolvedBody as any).kind}\"`);\n    }\n  }\n\n  let error: SerializedError | undefined;\n  let untransformedData;\n  let data;\n\n  try {\n    const res = await instrumentedFetch(queryUrl.href, requestInit);\n\n    if (!res.ok) {\n      throw new Error(`HTTP ${res.status} (${res.statusText}) while fetching \"${res.url}\"`);\n    }\n\n    untransformedData = await readData(res, fetchQuery);\n    data = untransformedData;\n\n    if (fetchQuery.transformEnabled && fetchQuery.transform) {\n      data = await applyTransform(jsRuntime, fetchQuery.transform, untransformedData);\n    }\n  } catch (rawError) {\n    error = serializeError(errorFrom(rawError));\n  }\n  return { data, untransformedData, error, har };\n}\n\nexport default function createDatasource(\n  project: IToolpadProject,\n): ServerDataSource<{}, FetchQuery, any> {\n  return {\n    async exec(\n      connection: Maybe<RestConnectionParams>,\n      fetchQuery: FetchQuery,\n      params: Record<string, string>,\n    ): Promise<ExecFetchResult<any>> {\n      const { data, error } = await execBase(project, connection, fetchQuery, params);\n      return { data, error };\n    },\n\n    async execPrivate(connection: Maybe<RestConnectionParams>, query: FetchPrivateQuery) {\n      switch (query.kind) {\n        case 'introspection': {\n          return {\n            env: process.env,\n            declaredEnvKeys: await project.envManager.getDeclaredKeys(),\n          } satisfies IntrospectionResult;\n        }\n        case 'debugExec':\n          return execBase(project, connection, query.query, query.params);\n        default:\n          throw new Error(`Unknown private query \"${(query as FetchPrivateQuery).kind}\"`);\n      }\n    },\n\n    api: {},\n  };\n}\n","import { withHar as withHarOriginal, FetchFn } from 'node-fetch-har';\nimport { Request } from 'node-fetch';\n\nconst withHarInstrumentation: typeof withHarOriginal = function withHar(fetchFn, options) {\n  const withHarFetch: FetchFn = withHarOriginal(fetchFn, options);\n\n  const patchedFetch: FetchFn = (...args: Parameters<FetchFn>): ReturnType<FetchFn> => {\n    // node-fetch-har doesn't deal well with certain ways of passing parameters e.g. passing headers as [string, string][]\n    // We're normalizing them here to a format that we know it can handle correctly:\n    const req = new Request(...args);\n    const input = req.url;\n    return withHarFetch(input, {\n      agent: req.agent,\n      body: req.body,\n      compress: req.compress,\n      follow: req.follow,\n      headers: req.headers,\n      method: req.method,\n      redirect: req.redirect,\n    });\n  };\n\n  return patchedFetch;\n};\n\nexport { createHarLog } from '../utils/har';\nexport { withHarInstrumentation };\n","import type { Har } from 'har-format';\n\n/**\n * Initializes an empty HAR object.\n */\nexport function createHarLog(): Har {\n  return {\n    log: {\n      version: '0.0',\n      creator: {\n        name: 'Toolpad',\n        version: process.env.TOOLPAD_VERSION || '',\n      },\n      entries: [],\n    },\n  };\n}\n\ninterface WithStartedDateTime {\n  startedDateTime: string;\n}\n\nfunction oldestFirst(a: WithStartedDateTime, b: WithStartedDateTime): number {\n  return new Date(a.startedDateTime).valueOf() - new Date(b.startedDateTime).valueOf();\n}\n\n/**\n * Merge two HAR files into a new one.\n */\nexport function mergeHar(target: Har, ...src: Har[]): Har {\n  for (const har of src) {\n    if (har.log.pages) {\n      if (!target.log.pages) {\n        target.log.pages = [];\n      }\n      target.log.pages.push(...har.log.pages);\n    }\n    target.log.entries.push(...har.log.entries);\n  }\n\n  target.log.entries.sort(oldestFirst);\n\n  if (target.log.pages) {\n    target.log.pages.sort(oldestFirst);\n  }\n\n  return target;\n}\n","import { JsRuntime } from '@toolpad/studio-runtime';\n\nexport default async function applyTransform(\n  jsRuntime: JsRuntime,\n  transform: string,\n  data: any,\n): Promise<any> {\n  const transformFn = `(data) => {${transform}}`;\n  const { error, value } = jsRuntime.evaluateExpression(\n    `(${transformFn})(${JSON.stringify(data)})`,\n    {},\n  );\n  if (error) {\n    throw error;\n  }\n  return value;\n}\n","import { ensureSuffix } from '@toolpad/utils/strings';\nimport { Maybe } from '@toolpad/utils/types';\nimport { Authentication } from './types';\n\nexport const HTTP_NO_BODY = new Set(['GET', 'HEAD']);\n\nexport function getAuthenticationHeaders(auth: Maybe<Authentication>): [string, string][] {\n  if (!auth) {\n    return [];\n  }\n\n  switch (auth.type) {\n    case 'basic':\n      return [\n        [\n          'Authorization',\n          `Basic ${Buffer.from(`${auth.user}:${auth.password}`, 'utf-8').toString('base64')}`,\n        ],\n      ];\n    case 'bearerToken':\n      return [['Authorization', `Bearer ${auth.token}`]];\n    case 'apiKey':\n      return [[auth.header, auth.key]];\n    default:\n      throw new Error(`Unsupported authentication type \"${(auth as Authentication).type}\"`);\n  }\n}\n\nexport function parseBaseUrl(baseUrl: string): URL {\n  const parsedBase = new URL(baseUrl);\n  parsedBase.pathname = ensureSuffix(parsedBase.pathname, '/');\n  parsedBase.search = '';\n  parsedBase.hash = '';\n  return parsedBase;\n}\n","import { drive_v3 } from '@googleapis/drive';\nimport { sheets_v4 } from '@googleapis/sheets';\nimport { OAuth2Client } from 'google-auth-library';\nimport { match } from 'path-to-regexp';\nimport { asArray } from '@toolpad/utils/collections';\nimport * as express from 'express';\nimport { Maybe } from '@toolpad/utils/types';\nimport invariant from 'invariant';\nimport { ServerDataSource, CreateHandlerApi } from '../../types';\nimport config from '../../server/config';\nimport {\n  GoogleSheetsConnectionParams,\n  GoogleSheetsPrivateQuery,\n  GoogleSheetsApiQuery,\n  GoogleSheetsResult,\n} from './types';\n\n/**\n * Create an OAuth2 client based on the configuration\n */\n\nfunction createOAuthClient(): OAuth2Client {\n  const externalUrl = process.env.TOOLPAD_EDITOR_EXTERNAL_URL;\n  invariant(externalUrl, 'Missing TOOLPAD_EDITOR_EXTERNAL_URL');\n  if (!config.googleSheetsClientId) {\n    throw new Error('Google Sheets: Missing client ID \"TOOLPAD_DATASOURCE_GOOGLESHEETS_CLIENT_ID\"');\n  }\n  if (!config.googleSheetsClientSecret) {\n    throw new Error(\n      'Google Sheets: Missing client secret \"TOOLPAD_DATASOURCE_GOOGLESHEETS_CLIENT_SECRET\"',\n    );\n  }\n  return new OAuth2Client(\n    config.googleSheetsClientId,\n    config.googleSheetsClientSecret,\n    new URL('/api/dataSources/googleSheets/auth/callback', externalUrl).href,\n  );\n}\n\n/**\n * Create a Google Drive client based on the configuration\n */\n\nfunction createDriveClient(client: OAuth2Client) {\n  if (!client) {\n    throw new Error('Malformed Google Sheets datasource client');\n  }\n  return new drive_v3.Drive({\n    auth: client,\n  });\n}\n\n/**\n * Create a Google Sheets client based on the configuration\n */\n\nfunction createSheetsClient(client: OAuth2Client) {\n  if (!client) {\n    throw new Error('Malformed Google Sheets datasource client');\n  }\n  return new sheets_v4.Sheets({\n    auth: client,\n  });\n}\n\nexport default function createDatasource(): ServerDataSource<\n  GoogleSheetsConnectionParams,\n  GoogleSheetsApiQuery,\n  GoogleSheetsPrivateQuery\n> {\n  /**\n   * Executor function for this connection\n   * @param connection  The connection object\n   * @param query  The query object\n   * @returns The api response\n   */\n  const exec = async (\n    connection: Maybe<GoogleSheetsConnectionParams>,\n    query: GoogleSheetsApiQuery,\n  ): Promise<GoogleSheetsResult> => {\n    const client = createOAuthClient();\n    if (connection) {\n      client.setCredentials(connection);\n    }\n    const sheets = createSheetsClient(client);\n\n    const { spreadsheetId, sheetName, ranges, headerRow } = query;\n    if (spreadsheetId && sheetName) {\n      const response = await sheets.spreadsheets.values.get({\n        spreadsheetId,\n        range: `${sheetName}!${ranges}`,\n      });\n      if (response.status === 200) {\n        const { values } = response.data;\n        if (values && values.length > 0) {\n          let data = values;\n          if (headerRow) {\n            const firstRow = values.shift() ?? [];\n            data = values.map((row) => {\n              const rowObject: any = {};\n              row.forEach((elem, cellIndex) => {\n                if (firstRow[cellIndex]) {\n                  rowObject[firstRow[cellIndex]] = elem;\n                }\n              });\n              return rowObject;\n            });\n          }\n          return { data };\n        }\n        return { data: [] };\n      }\n\n      throw new Error(\n        `${response.status}: ${response.statusText} Failed to fetch \"${JSON.stringify(query)}\"`,\n      );\n    }\n    throw new Error(`No sheet selected`);\n  };\n\n  /**\n   * Private executor function for this connection\n   * @param connection  The connection object\n   * @param query  The query object\n   * @returns The private api response\n   */\n  const execPrivate = async (\n    connection: Maybe<GoogleSheetsConnectionParams>,\n    query: GoogleSheetsPrivateQuery,\n  ): Promise<any> => {\n    const client = createOAuthClient();\n    if (connection) {\n      client.setCredentials(connection);\n    }\n    if (query.type === 'FILE_GET') {\n      const driveClient = createDriveClient(client);\n      const { spreadsheetId } = query;\n      if (spreadsheetId) {\n        const response = await driveClient.files.get({\n          fileId: spreadsheetId,\n        });\n        if (response.status === 200) {\n          return response.data;\n        }\n        throw new Error(\n          `${response?.status}: ${response.statusText} Failed to fetch \"${JSON.stringify(query)}\"`,\n        );\n      }\n      throw new Error(`Google Sheets: Missing spreadsheetId in query`);\n    }\n    if (query.type === 'FILES_LIST') {\n      const driveClient = createDriveClient(client);\n      const { spreadsheetQuery, pageToken } = query;\n      let queryString = \"mimeType='application/vnd.google-apps.spreadsheet'\";\n      if (spreadsheetQuery) {\n        /** Escaping spreadsheetQuery\n         *  based on: https://developers.google.com/drive/api/guides/ref-search-terms#file_properties\n         */\n        const escapedSpreadsheetQuery = spreadsheetQuery.replace(/\\\\|'/g, '\\\\$&');\n        queryString = `name contains '${escapedSpreadsheetQuery}' and ${queryString}`;\n      }\n\n      const response = await driveClient.files.list({\n        q: queryString,\n        pageToken,\n      });\n\n      if (response.status === 200) {\n        return response.data;\n      }\n      throw new Error(\n        `${response?.status}: ${response.statusText} Failed to fetch \"${JSON.stringify(query)}\"`,\n      );\n    }\n    if (query.type === 'FETCH_SPREADSHEET') {\n      const sheetsClient = createSheetsClient(client);\n      const { spreadsheetId } = query;\n      if (spreadsheetId) {\n        const response = await sheetsClient.spreadsheets.get({\n          spreadsheetId,\n          includeGridData: false,\n        });\n        if (response.status === 200) {\n          return response.data;\n        }\n        throw new Error(\n          `${response?.status}: ${response.statusText} Failed to fetch \"${JSON.stringify(query)}\"`,\n        );\n      }\n      throw new Error(`Google Sheets: Missing spreadsheetId in query`);\n    }\n    if (query.type === 'CONNECTION_STATUS') {\n      const driveClient = createDriveClient(client);\n      const response = await driveClient.about.get({ fields: 'user' });\n      if (response.status === 200) {\n        return response.data.user;\n      }\n      return null;\n    }\n    if (query.type === 'DEBUG_EXEC') {\n      return exec(connection, query.query);\n    }\n    throw new Error(`Google Sheets: Unrecognized private query \"${JSON.stringify(query)}\"`);\n  };\n\n  return {\n    exec,\n    execPrivate,\n    api: {},\n    createHandler: () => {\n      /**\n       * Handler for new connections\n       * @param api  The api for the handler object\n       * @param req  The request object\n       * @param res The response object\n       */\n\n      return async (\n        api: CreateHandlerApi<GoogleSheetsConnectionParams>,\n        req: express.Request,\n        res: express.Response,\n      ): Promise<express.Response | void> => {\n        const client = createOAuthClient();\n        try {\n          const pathname = `/${asArray(req.query.path)\n            .map((segment = '') => encodeURIComponent(String(segment)))\n            .join('/')}`;\n          const matchAuthLogin = match('/auth/login', { decode: decodeURIComponent });\n          const matchAuthCallback = match('/auth/callback', { decode: decodeURIComponent });\n\n          const [state] = asArray(req.query.state);\n          if (typeof state !== 'string') {\n            return res.status(400).send(`Missing query parameter \"state\"`);\n          }\n          const { connectionId } = JSON.parse(decodeURIComponent(state));\n\n          // Check if connection with connectionId exists, if so: merge\n          const savedConnection = await api.getConnectionParams(connectionId);\n          if (savedConnection) {\n            client.setCredentials(savedConnection);\n          }\n          if (matchAuthLogin(pathname)) {\n            return res.redirect(\n              client.generateAuthUrl({\n                access_type: 'offline',\n                scope: [\n                  'https://www.googleapis.com/auth/spreadsheets.readonly',\n                  'https://www.googleapis.com/auth/drive.readonly',\n                ],\n                state,\n                include_granted_scopes: true,\n                prompt: 'consent',\n              }),\n            );\n          }\n          if (matchAuthCallback(pathname)) {\n            const [oAuthError] = asArray(req.query.error);\n            if (oAuthError) {\n              throw new Error(String(oAuthError));\n            }\n            const [code] = asArray(req.query.code);\n            if (typeof code !== 'string') {\n              return res.status(400).send(`Missing query parameter \"code\"`);\n            }\n            const { tokens, res: getTokenResponse } = await client.getToken(code);\n            if (!tokens) {\n              throw new Error(`${getTokenResponse?.status}: ${getTokenResponse?.statusText}`);\n            }\n            if (tokens) {\n              client.setCredentials(tokens);\n              await api.setConnectionParams(connectionId, client.credentials);\n            }\n            return res.redirect(`/_toolpad/app/connections/${encodeURIComponent(connectionId)}`);\n          }\n          return res.status(404).send('No handler exists for given path');\n        } catch (error) {\n          if (error instanceof Error) {\n            console.error(error.message);\n            return res.status(500).send(error.message);\n          }\n          return res.status(500).send(error);\n        }\n      };\n    },\n  };\n}\n","type BasicAuthConfig =\n  | {\n      basicAuthUser: string;\n      basicAuthPassword: string;\n    }\n  | {\n      basicAuthUser?: undefined;\n      basicAuthPassword?: undefined;\n    };\n\nexport type ServerConfig = {\n  databaseUrl?: string;\n  googleSheetsClientId?: string;\n  googleSheetsClientSecret?: string;\n  encryptionKeys: string[];\n  basicAuthUser?: string;\n  basicAuthPassword?: string;\n} & BasicAuthConfig;\n\nfunction readConfig(): ServerConfig {\n  if (typeof window !== 'undefined') {\n    throw new Error(`Server-side config can't be loaded on the client side`);\n  }\n\n  // Whitespace separated, do not use spaces in your keys\n  const encryptionKeys: string[] =\n    process.env.TOOLPAD_ENCRYPTION_KEYS?.split(/\\s+/).filter(Boolean) ?? [];\n\n  let basicAuthConfig: BasicAuthConfig = {};\n  if (process.env.TOOLPAD_BASIC_AUTH_USER && process.env.TOOLPAD_BASIC_AUTH_PASSWORD) {\n    basicAuthConfig = {\n      basicAuthUser: process.env.TOOLPAD_BASIC_AUTH_USER,\n      basicAuthPassword: process.env.TOOLPAD_BASIC_AUTH_PASSWORD,\n    };\n  } else if (process.env.TOOLPAD_BASIC_AUTH_USER) {\n    throw new Error(\n      `Basic Auth user configured without password. Please provide the TOOLPAD_BASIC_AUTH_PASSWORD environment variable.`,\n    );\n  }\n\n  return {\n    ...basicAuthConfig,\n    databaseUrl: process.env.TOOLPAD_DATABASE_URL,\n    googleSheetsClientId: process.env.TOOLPAD_DATASOURCE_GOOGLESHEETS_CLIENT_ID,\n    googleSheetsClientSecret: process.env.TOOLPAD_DATASOURCE_GOOGLESHEETS_CLIENT_SECRET,\n    encryptionKeys,\n  };\n}\n\nexport default readConfig();\n","export type ParsedFunctionId =\n  | {\n      file: string;\n      handler?: undefined;\n    }\n  | {\n      file: string;\n      handler: string;\n    };\n\nexport function parseLegacyFunctionId(id: string): ParsedFunctionId {\n  if (!id) {\n    return { file: 'functions.ts' };\n  }\n  const [file, handler] = id.split('#');\n  return handler ? { file, handler } : { file: 'functions.ts', handler: file };\n}\n\nexport function parseFunctionId(id: string): ParsedFunctionId {\n  const [file, handler] = id.split('#');\n  return handler ? { file, handler } : { file };\n}\n\nexport function serializeFunctionId({ file, handler }: ParsedFunctionId): string {\n  return handler ? `${file}#${handler}` : file;\n}\n\nexport function transformLegacyFunctionId(id: string): string {\n  if (!id) {\n    return '';\n  }\n  const [file, handler] = id.split('#');\n  return handler ? id : `functions.ts#${file}`;\n}\n","import { ExecFetchResult } from '@toolpad/studio-runtime';\nimport { Maybe } from '@toolpad/utils/types';\nimport { ServerDataSource } from '../../types';\nimport { LocalQuery, LocalConnectionParams, LocalPrivateApi } from './types';\nimport { parseLegacyFunctionId } from './shared';\nimport type { IToolpadProject } from '../server';\n\nexport default function createDatasource(\n  project: IToolpadProject,\n): ServerDataSource<{}, LocalQuery, any, LocalPrivateApi> {\n  const exec = async (\n    connection: Maybe<LocalConnectionParams>,\n    fetchQuery: LocalQuery,\n    parameters: Record<string, string>,\n  ): Promise<ExecFetchResult<any>> => {\n    if (!fetchQuery.function) {\n      throw new Error('Missing function name');\n    }\n    const parsed = parseLegacyFunctionId(fetchQuery.function);\n    if (!parsed.handler) {\n      throw new Error('Missing function name');\n    }\n    const { data, error } = await project.functionsManager.exec(\n      parsed.file,\n      parsed.handler,\n      parameters,\n    );\n    return { data, error };\n  };\n\n  return {\n    exec,\n    api: {\n      async introspection() {\n        return project.functionsManager.introspect();\n      },\n      async debugExec(query, params) {\n        return exec(null, query, params);\n      },\n      async createNew(fileName) {\n        return project.functionsManager.createFunctionFile(fileName);\n      },\n    },\n  };\n}\n","import type { ServerDataSource } from '../types';\nimport postgres from './postgres/server';\nimport mysql from './mysql/server';\nimport rest from './rest/server';\nimport googleSheets from './googleSheets/server';\nimport local from './local/server';\nimport type FunctionsManager from '../server/FunctionsManager';\nimport type EnvManager from '../server/EnvManager';\n\nexport interface IToolpadProject {\n  functionsManager: FunctionsManager;\n  envManager: EnvManager;\n}\n\ntype ServerDataSources = {\n  [key: string]:\n    | ServerDataSource<any, any, any>\n    | ((project: IToolpadProject) => ServerDataSource<any, any, any>)\n    | undefined;\n};\n\nconst dataSources: ServerDataSources = {\n  rest,\n  postgres,\n  googleSheets,\n  mysql,\n  local,\n};\n\nexport default dataSources;\n","import * as express from 'express';\nimport { Awaitable } from '@toolpad/utils/types';\n\nexport function asyncHandler(\n  handler: (\n    req: express.Request,\n    res: express.Response,\n    next: express.NextFunction,\n  ) => Awaitable<void>,\n): express.RequestHandler {\n  return (req, res, next) => {\n    Promise.resolve(handler(req, res, next)).catch(next);\n  };\n}\n","import * as appDom from '@toolpad/studio-runtime/appDom';\n\nexport const PAGE_ROW_COMPONENT_ID = 'PageRow';\nexport const PAGE_COLUMN_COMPONENT_ID = 'PageColumn';\nexport const SPACER_COMPONENT_ID = 'Spacer';\nexport const STACK_COMPONENT_ID = 'Stack';\nexport const FORM_COMPONENT_ID = 'Form';\n\nexport function getElementNodeComponentId(elementNode: appDom.ElementNode): string {\n  return elementNode.attributes.component;\n}\n\nexport function isPageRow(elementNode: appDom.ElementNode): boolean {\n  return getElementNodeComponentId(elementNode) === PAGE_ROW_COMPONENT_ID;\n}\n\nexport function isPageColumn(elementNode: appDom.ElementNode): boolean {\n  return getElementNodeComponentId(elementNode) === PAGE_COLUMN_COMPONENT_ID;\n}\n\nexport function isPageLayoutComponent(elementNode: appDom.ElementNode): boolean {\n  return isPageRow(elementNode) || isPageColumn(elementNode);\n}\n\nexport function isFormComponent(elementNode: appDom.ElementNode): boolean {\n  return getElementNodeComponentId(elementNode) === FORM_COMPONENT_ID;\n}\n","import * as path from 'path';\nimport * as url from 'node:url';\nimport * as fs from 'fs';\n\nconst currentDirectory = url.fileURLToPath(new URL('.', String(import.meta.url)));\n\nconst pkgJsonContent = fs.readFileSync(path.resolve(currentDirectory, '../../package.json'), {\n  encoding: 'utf-8',\n});\nconst pkgJson = JSON.parse(pkgJsonContent);\n\nexport interface PackageInfo {\n  version: string;\n  build: string;\n}\n\nexport default {\n  version: pkgJson.version,\n  build: process.env.GIT_SHA1?.slice(0, 7) || 'dev',\n} satisfies PackageInfo;\n"],"mappings":"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","names":["invariant","path","path","fs","invariant","chalk","fromZodError","glob","chokidar","errorFrom","writeFileRecursive","fileExists","readJsonFile","z","appDom","config","readConfig","path","path","fs","indent","chokidar","chalk","url","path","url","fs","z","currentDirectory","indent","chalk","path","fileExists","fileExists","createServerJsRuntime","invariant","errorFrom","serializeError","appDom","errorFrom","errorFrom","execSql","testConnection","match","errorFrom","errorFrom","match","execSql","errorFrom","testConnection","server_default","errorFrom","serializeError","ensureSuffix","serializeError","errorFrom","invariant","invariant","createDatasource","createDatasource","createDatasource","server_default","serializeError","errorFrom","server_default","dataSources","createServerJsRuntime","invariant","path","url","fs","currentDirectory","pkgJsonContent","pkgJson","invariant","errorFrom","chalk","fromZodError","z","fileExists","writeFileRecursive","glob","config","readJsonFile","pageFilePath","stat","invariant"]}