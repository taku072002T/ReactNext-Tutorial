import {
  getDesignTokens
} from "./chunk-UAYT4TLE.js";
import {
  nanoid,
  require_browser
} from "./chunk-OHP53Y5E.js";
import {
  clsx_default,
  lighten,
  rgbToHex,
  styled_default2 as styled_default,
  useTheme
} from "./chunk-UDNLGK53.js";
import {
  editor_main_exports
} from "./chunk-WR5QW6JP.js";
import {
  conf as conf2,
  language as language2
} from "./chunk-I4SGHORQ.js";
import {
  conf,
  language
} from "./chunk-565U2LSB.js";
import {
  Uri,
  editor,
  languages
} from "./chunk-SGWWLOE7.js";
import {
  conf as conf3,
  language as language3
} from "./chunk-MGVKIDLG.js";
import {
  require_react
} from "./chunk-4OKMCUX3.js";
import {
  __toESM
} from "./chunk-7LSNTUAC.js";

// node_modules/@toolpad/studio/dist/exports/chunk-CFEA35V7.mjs
var React = __toESM(require_react(), 1);
var import_invariant = __toESM(require_browser(), 1);
if (typeof window === "undefined") {
  throw new Error(`Browser-only module loaded outside of the browser`);
}
function getExtension(language4) {
  switch (language4) {
    case "typescript":
      return ".tsx";
    case "json":
      return ".json";
    case "javascript":
      return ".jsx";
    case "markdown":
      return ".md";
    case "css":
      return ".css";
    case "html":
      return ".html";
    case "plaintext":
      return ".txt";
    default:
      return ".jsx";
  }
}
var designTokensDark = getDesignTokens("dark");
var _a, _b, _c, _d, _e;
(0, import_invariant.default)(
  ((_b = (_a = designTokensDark.palette) == null ? void 0 : _a.background) == null ? void 0 : _b.default) && ((_d = (_c = designTokensDark.palette) == null ? void 0 : _c.background) == null ? void 0 : _d.paper) && ((_e = designTokensDark.palette) == null ? void 0 : _e.divider),
  "dark theme tokens missing"
);
var editorBackground = rgbToHex(lighten(designTokensDark.palette.background.default, 0.05));
var paperBackground = rgbToHex(designTokensDark.palette.background.paper);
var dividerColor = rgbToHex(designTokensDark.palette.divider);
editor.defineTheme("vs-toolpad-dark", {
  base: "vs-dark",
  inherit: true,
  rules: [],
  colors: {
    // See https://code.visualstudio.com/api/references/theme-color
    "editor.background": editorBackground,
    "menu.background": paperBackground,
    "menu.border": dividerColor,
    "menu.separatorBackground": dividerColor,
    "editorWidget.background": paperBackground,
    "editorWidget.border": dividerColor,
    "editor.lineHighlightBorder": dividerColor
  }
});
editor.defineTheme("vs-toolpad-light", {
  base: "vs",
  inherit: true,
  rules: [],
  colors: {}
});
function registerLanguage(langId, language4, conf4) {
  languages.register({ id: langId });
  languages.registerTokensProviderFactory(langId, {
    create: async () => language4
  });
  languages.onLanguage(langId, async () => {
    languages.setLanguageConfiguration(langId, conf4);
  });
}
registerLanguage("jsonBasic", language2, conf2);
registerLanguage("typescriptBasic", language, conf);
registerLanguage("markdownBasic", language3, conf3);
var JSON_DEFAULT_DIAGNOSTICS_OPTIONS = {};
languages.json.jsonDefaults.setDiagnosticsOptions(JSON_DEFAULT_DIAGNOSTICS_OPTIONS);
var TYPESCRIPT_DEFAULT_DIAGNOSTICS_OPTIONS = {
  noSemanticValidation: false,
  noSyntaxValidation: false
};
languages.typescript.typescriptDefaults.setDiagnosticsOptions(
  TYPESCRIPT_DEFAULT_DIAGNOSTICS_OPTIONS
);
var TYPESCRIPT_DEFAULT_COMPILER_OPTIONS = {
  target: languages.typescript.ScriptTarget.Latest,
  allowNonTsExtensions: true,
  moduleResolution: languages.typescript.ModuleResolutionKind.NodeJs,
  module: languages.typescript.ModuleKind.ESNext,
  noEmit: true,
  esModuleInterop: true,
  jsx: languages.typescript.JsxEmit.React,
  reactNamespace: "React",
  allowJs: true,
  lib: ["es2020"],
  typeRoots: ["node_modules/@types"],
  strictNullChecks: true
};
languages.typescript.typescriptDefaults.setCompilerOptions(
  TYPESCRIPT_DEFAULT_COMPILER_OPTIONS
);
var classes = {
  monacoHost: "Toolpad_MonacoEditorMonacoHost",
  overlay: "Toolpad_MonacoEditorOverlay",
  disabled: "Toolpad_MonacoEditorDisabled"
};
var EditorRoot = styled_default("div")(({ theme }) => ({
  height: "100%",
  position: "relative",
  [`& .${classes.monacoHost}`]: {
    position: "absolute",
    inset: "0 0 0 0"
  },
  [`& .${classes.overlay}`]: {
    position: "absolute",
    inset: "0 0 0 0",
    background: theme.palette.background.default,
    opacity: 0.5,
    display: "none"
  },
  [`&.${classes.disabled}`]: {
    pointerEvents: "none"
  },
  [`&.${classes.disabled} .${classes.overlay}`]: {
    display: "block"
  }
}));
var overflowWidgetsDomNode = null;
function getOverflowWidgetsDomNode(theme) {
  if (!overflowWidgetsDomNode) {
    overflowWidgetsDomNode = document.createElement("div");
    overflowWidgetsDomNode.classList.add("monaco-editor");
    overflowWidgetsDomNode.style.zIndex = String(theme.zIndex.tooltip + 1);
    document.body.append(overflowWidgetsDomNode);
  }
  return overflowWidgetsDomNode;
}
var MonacoEditor_default = React.forwardRef(function MonacoEditor({
  value,
  onChange,
  sx,
  language: language4 = "plaintext",
  diagnostics,
  compilerOptions,
  extraLibs,
  onFocus,
  onBlur,
  className,
  disabled,
  options,
  autoFocus,
  ...props
}, ref) {
  const rootRef = React.useRef(null);
  const instanceRef = React.useRef(null);
  const theme = useTheme();
  const monacoTheme = theme.palette.mode === "dark" ? "vs-toolpad-dark" : "vs-toolpad-light";
  const [isFocused, setIsFocused] = React.useState(false);
  React.useEffect(() => {
    var _a2;
    const model = (_a2 = instanceRef.current) == null ? void 0 : _a2.getModel();
    if (!model) {
      return;
    }
    if (language4 === "json") {
      if (isFocused) {
        editor.setModelLanguage(model, "json");
        languages.json.jsonDefaults.setDiagnosticsOptions({
          ...JSON_DEFAULT_DIAGNOSTICS_OPTIONS,
          ...diagnostics
        });
      } else {
        editor.setModelLanguage(model, "jsonBasic");
      }
    } else if (language4 === "typescript") {
      if (isFocused) {
        editor.setModelLanguage(model, "typescript");
        languages.typescript.typescriptDefaults.setDiagnosticsOptions({
          ...TYPESCRIPT_DEFAULT_DIAGNOSTICS_OPTIONS,
          ...diagnostics
        });
        languages.typescript.typescriptDefaults.setCompilerOptions({
          ...TYPESCRIPT_DEFAULT_COMPILER_OPTIONS,
          ...compilerOptions
        });
        languages.typescript.typescriptDefaults.setExtraLibs(extraLibs || []);
      } else {
        editor.setModelLanguage(model, "typescriptBasic");
      }
    } else {
      editor.setModelLanguage(model, language4);
    }
  }, [isFocused, language4, diagnostics, extraLibs, compilerOptions]);
  React.useEffect(() => {
    (0, import_invariant.default)(rootRef.current, "Ref not attached");
    const extraOptions = {
      readOnly: disabled,
      theme: monacoTheme,
      scrollbar: {
        alwaysConsumeMouseWheel: false,
        ...options == null ? void 0 : options.scrollbar
      },
      ...options
    };
    let instance = instanceRef.current;
    if (instance) {
      instance.updateOptions(extraOptions);
      const model = instance.getModel();
      if (typeof value === "string" && model) {
        const actualValue = model.getValue();
        if (value !== actualValue) {
          const state = instance.saveViewState();
          instance.executeEdits(null, [
            {
              range: model.getFullModelRange(),
              text: value
            }
          ]);
          if (state) {
            instance.restoreViewState(state);
          }
        }
      }
    } else {
      const pathUri = Uri.parse(`/scripts/${nanoid(7)}${getExtension(language4)}`);
      const model = editor.createModel(value || "", language4, pathUri);
      instance = editor.create(rootRef.current, {
        model,
        language: language4,
        minimap: { enabled: false },
        accessibilitySupport: "off",
        tabSize: 2,
        automaticLayout: true,
        fixedOverflowWidgets: true,
        // See https://github.com/microsoft/monaco-editor/issues/181
        overflowWidgetsDomNode: getOverflowWidgetsDomNode(theme),
        ...extraOptions
      });
      instanceRef.current = instance;
      instance.onDidFocusEditorWidget(() => setIsFocused(true));
      instance.onDidBlurEditorWidget(() => setIsFocused(false));
      if (autoFocus && !disabled) {
        instance.focus();
      }
    }
  }, [language4, value, options, disabled, autoFocus, theme, monacoTheme]);
  React.useEffect(() => {
    const editor2 = instanceRef.current;
    const onDidChangeModelContentSub = editor2 == null ? void 0 : editor2.onDidChangeModelContent(() => {
      const editorValue = editor2.getValue();
      if (onChange && value !== editorValue) {
        onChange(editorValue);
      }
    });
    return () => onDidChangeModelContentSub == null ? void 0 : onDidChangeModelContentSub.dispose();
  }, [onChange, value]);
  React.useEffect(() => {
    const editor2 = instanceRef.current;
    if (onFocus) {
      const onDidFocusEditorTextSub = editor2 == null ? void 0 : editor2.onDidFocusEditorText(onFocus);
      return () => onDidFocusEditorTextSub == null ? void 0 : onDidFocusEditorTextSub.dispose();
    }
    return () => {
    };
  }, [onFocus]);
  React.useEffect(() => {
    const editor2 = instanceRef.current;
    if (onBlur) {
      const onDidBlurEditorTextSub = editor2 == null ? void 0 : editor2.onDidBlurEditorText(onBlur);
      return () => onDidBlurEditorTextSub == null ? void 0 : onDidBlurEditorTextSub.dispose();
    }
    return () => {
    };
  }, [onBlur]);
  React.useEffect(() => {
    return () => {
      var _a2, _b2, _c2;
      (_b2 = (_a2 = instanceRef.current) == null ? void 0 : _a2.getModel()) == null ? void 0 : _b2.dispose();
      (_c2 = instanceRef.current) == null ? void 0 : _c2.dispose();
      instanceRef.current = null;
    };
  }, []);
  React.useImperativeHandle(ref, () => {
    return {
      get editor() {
        const editor2 = instanceRef.current;
        if (!editor2) {
          throw new Error("Editor not created yet");
        }
        return editor2;
      },
      get monaco() {
        return editor_main_exports;
      }
    };
  }, []);
  return React.createElement(EditorRoot, { className: clsx_default({ [classes.disabled]: disabled }, className), sx, ...props }, React.createElement("div", { className: classes.monacoHost, ref: rootRef }), React.createElement("div", { className: classes.overlay }));
});

export {
  MonacoEditor_default
};
//# sourceMappingURL=chunk-SS43PZMJ.js.map
